---
title: "Analyses of learning via shared features experiments"
author: "Ian Hussey"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    number_sections: no
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)
```

```{r}

# disable scientific notation
options(scipen = 999) 

# dependencies
library(tidyverse)
library(effsize)
library(foreign)
library(timesavers)
library(BayesFactor)
library(weights)
library(sjPlot)
library(nnet)
library(metafor)
library(car)
library(lsr)
library(knitr)
library(kableExtra)

```

# Get data

```{r}

data_exp_1 <- read_csv("../experiment 1/data/processed/data_for_analysis.csv")
data_exp_2 <- read_csv("../experiment 2/data/processed/data_for_analysis.csv")
data_exp_3 <- read_csv("../experiment 3/data/processed/data_for_analysis.csv")
data_exp_4 <- read_csv("../experiment 4/data/processed/data_for_analysis.csv")
data_exp_5 <- read_csv("../experiment 5/data/processed/data_for_analysis.csv")
data_exp_6 <- read_csv("../experiment 6/data/processed/data_for_analysis.csv")
data_exp_7 <- read_csv("../experiment 7/data/processed/data_for_analysis.csv")
data_exp_8 <- read_csv("../experiment 8/data/processed/data_for_analysis.csv")
data_exp_9 <- read_csv("../experiment 9/data/processed/data_for_analysis.csv")

# subsets of conditions
data_exp_8nri <- data_exp_8 %>%
  filter(Bag_Matching == "Shared_Feature_Bag_Location_Condition_1")

data_exp_8ri <- data_exp_8 %>%
  filter(Bag_Matching == "Shared_Feature_Bag_Random_Condition_3")

```

# Analytic strategy

```{r}

# analysis workflow. is applied witin all studies ---------------

# between groups comparisons analysis workflow ------
t_test_analyses <- function(data) {
  
  # summary stats
  summary_stats <- data %>%
    group_by(IV) %>%
    dplyr::summarize(mean = mean(DV),
                     sd = sd(DV)) %>%
    round_df(2)
  
  # t test
  t_test <- t.test(formula = DV ~ IV,
                   alternative = "two.sided",
                   paired = FALSE,
                   data = data)
  
  # effect size
  # formula based cohen's d seems to be invariant to ordering of the levels, can't control whether the direction 
  # cohens_d <- effsize::cohen.d(formula = DV ~ IV,
  #                              paired = FALSE,
  #                              data = data)
  cohens_d <- effsize::cohen.d(data$DV[data$IV == "CS1_Positive_CS2_Negative"],
                               data$DV[data$IV == "CS2_Positive_CS1_Negative"],
                               paired = FALSE)
  
  # printing
  t_test_p <- t_test$p.value[[1]]
  t_test_p_apa <- ifelse(t_test_p < 0.001, "< .001", 
                         ifelse(t_test_p < 0.01,
                                paste("= ", rd(t_test_p, 3), sep = ""),  # rd() rounds, converts to string, and removes the leading 0.
                                paste("= ", rd(t_test_p, 2), sep = "")))
  
  t_test_output <- paste("t(", format(round(t_test$parameter[[1]], 2), nsmall = 2), 
                         ") = ", format(round(t_test$statistic[[1]], 2), nsmall = 2), 
                         ", p ", t_test_p_apa, 
                         ", d = ", format(round(cohens_d$estimate[[1]], 2), nsmall = 2), 
                         ", 95% CI = [", format(round(cohens_d$conf.int[["lower"]], 2), nsmall = 2), ", ", 
                         format(round(cohens_d$conf.int[["upper"]], 2), nsmall = 2), "]", 
                         sep = "")
  
  # bayes factor t test
  t_test_bf <- ttestBF(formula = DV ~ IV,
                       data = data)
  
  bf10 <- round(exp(t_test_bf@bayesFactor$bf), 2)
  
  return(list(summary_stats = summary_stats,
              t_test = t_test,
              cohens_d = cohens_d,
              t_test_output = t_test_output,
              t_test_p = t_test_p,
              t_test_bf = t_test_bf,
              bf10 = bf10))
}

# multinominal analysis workflow ------
multinominal_analysis <- function(data) {
  
  # fit model
  fit <- multinom(DV ~ IV, 
                  data = data)
  
  # calculate p values
  z <- summary(fit)$coefficients/summary(fit)$standard.errors
  p <- (1 - pnorm(abs(z), 0, 1)) * 2
  
  pvalues <- p %>%
    as.data.frame() %>%
    rownames_to_column(var = "var") %>%
    
    rename(p = "IVCS2_Positive_CS1_Negative") %>%
    mutate(p = apa_p_value(p)) %>%
    select(p)
  
  # calc odds ratios and CIs
  coefficients <- as.data.frame(summary(fit)$coefficients) %>%
    rownames_to_column(var = "var") %>%
    rename(logOR = "IVCS2_Positive_CS1_Negative") %>%
    select(var, logOR)
  
  se <- as.data.frame(summary(fit)$standard.errors) %>%
    rownames_to_column(var = "var") %>%
    rename(logOR_se = "IVCS2_Positive_CS1_Negative") %>%
    select(logOR_se)
  
  # combine
  results <- cbind(coefficients, se) %>%
    mutate(OR = round(exp(logOR), 2),
           OR_ci_lwr = round(exp(logOR - logOR_se*1.96), 2),
           OR_ci_upr = round(exp(logOR + logOR_se*1.96), 2)) %>%
    cbind(pvalues) 
  
  return(results)
}

# meta analysis workflow ------
meta_analysis_workflow <- function(data, 
                                   effect_size_label, 
                                   reference_line, 
                                   exp_estimates = FALSE,
                                   plot = TRUE) {
  require(timesavers)
  require(tidyverse)
  require(metafor)
  
  # fit random effects model 
  fitted_model <- 
    rma(yi = yi, 
        sei = sei,
        data = data,
        slab = Experiment)
  
  p_value <- apa_p_value(fitted_model$pval)
  
  # model predictions
  meta_analysis_results <-
    predict(fitted_model, digits = 5) %>%
    as.data.frame() %>%
    gather() %>%
    round_df(2) %>%
    dplyr::rename(metric = key,
                  estimate = value) %>%
    mutate(metric = dplyr::recode(metric,
                                  "pred" = paste0("Meta analysed ", effect_size_label),
                                  "ci.lb" = "95% CI lower",
                                  "ci.ub" = "95% CI upper",
                                  "cr.lb" = "95% CR lower",
                                  "cr.ub" = "95% CR upper"))
  
  # source_valence_conditionally exponentiate estimates if converting log odds to odds ratios
  if(exp_estimates == TRUE) {
    meta_analysis_results <- meta_analysis_results %>%
      mutate(estimate = round(exp(estimate), 2))
  }
  
  meta_analysis_results <- rbind(meta_analysis_results,
                                 data.frame(metric = "p",
                                            estimate = p_value))
  
  # summarize results
  meta_analysis_results_text <- 
    paste0("k = ", fitted_model$k, ", ", 
           effect_size_label, " = ", meta_analysis_results$estimate[1],
           # dynamic indexing of some values as different models return variables in different locations, but relative location is reliable
           ", 95% CI = [", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-4],  
           ", ", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-3], 
           "], 95% CR = [", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-2], 
           ", ", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-1],
           "], p ", meta_analysis_results$estimate[length(meta_analysis_results$estimate)])
  
  heterogeneity_test_results_text <- 
    paste0("Q(df = ",    fitted_model$k - 1, ") = ", round(fitted_model$QE, 2), 
           ", p ",     ifelse(fitted_model$pval < 0.001, "< .001", as.character(paste("=", round(fitted_model$pval, 3)))),
           ", tau^2 = ", round(fitted_model$tau2, 2), 
           ", I^2 = ",   round(fitted_model$I2, 2), "%",
           ", H^2 = ",   round(fitted_model$H2, 2))
  
  # forest plot
  if (exp_estimates == TRUE) {
    transformation <- exp
  } else { 
    transformation <- NULL
  }
  
  
  if (plot == TRUE) {
    forest_plot <- forest(fitted_model,
                          xlab = effect_size_label,
                          addcred = TRUE,
                          atransf = transformation,
                          refline = reference_line)
  } else {
    forest_plot <- NULL
  }
  
  
  return(list(fitted_model = fitted_model, 
              meta_analysis_results = meta_analysis_results,
              meta_analysis_results_text = meta_analysis_results_text,
              heterogeneity_test_results_text = heterogeneity_test_results_text,
              forest_plot = forest_plot))
}


# robustness between original test and subset -----------
robust_test <- function(subset_test, original_test) {
  
  subset_p <- subset_test$estimate[subset_test$metric == "p"] %>%
    str_remove(., "=") %>%
    str_remove(., "<") %>%
    str_remove(., " ") %>%
    as.numeric()
  
  original_p <- original_test$estimate[original_test$metric == "p"] %>%
    str_remove(., "=") %>%
    str_remove(., "<") %>%
    str_remove(., " ") %>%
    as.numeric()
  
  return((subset_p >= 0.05 & original_p >= 0.05) | (subset_p < 0.05 & original_p < 0.05))
}


# moderator meta analysis workflow ------
moderator_meta_analysis_workflow <- function(data, 
                                             effect_size_label = "Cohen's d") {
  require(timesavers)
  require(tidyverse)
  require(metafor)
  
  # fit random effects model 
  fitted_model <- 
    rma(yi = yi, 
        sei = sei,
        data = data,
        mods = ~ exclude,
        slab = paste(Experiment, ifelse(exclude == TRUE, "excluded", "retained"), sep = " - "))

  # summarize moderator results
  mod_meta_analysis_results_text <- 
    paste0("QM(df = 1) = ", round(fitted_model$QM, 2), 
           ", p ", ifelse(fitted_model$QMp < 0.001, "< .001", as.character(paste("=", round(fitted_model$QMp, 3)))),
           ", difference in excluded subset ", effect_size_label, " = ", round(fitted_model$b[2], 2), 
           ", 95% CI [", round(fitted_model$ci.lb[2], 2), ", ", round(fitted_model$ci.ub[2], 2), "]")
  
  return(list(fitted_model = fitted_model, 
              mod_meta_analysis_results_text = mod_meta_analysis_results_text))
  
}

```

# Experiments 

## Experiment 1

### Demographics

```{r}

data_exp_1 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_1 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

results_exp_1_h1 <- data_exp_1 %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_1_h1$summary_stats$mean[results_exp_1_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h1$summary_stats$sd[results_exp_1_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_1_h1$summary_stats$mean[results_exp_1_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h1$summary_stats$sd[results_exp_1_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_1_h1$t_test_output`, BF10 = `r format(results_exp_1_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_1_h2 <- data_exp_1 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_1_h2$summary_stats$mean[results_exp_1_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h2$summary_stats$sd[results_exp_1_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_1_h2$summary_stats$mean[results_exp_1_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h2$summary_stats$sd[results_exp_1_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_1_h2$t_test_output`, BF10 = `r format(results_exp_1_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_1$intention <- relevel(as.factor(data_exp_1$intention), ref = "Morag")

results_exp_1_h3 <- data_exp_1 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_1_h3$OR[results_exp_1_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_1_h3$OR_ci_lwr[results_exp_1_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_1_h3$OR_ci_upr[results_exp_1_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_1_h3$p[results_exp_1_h3$var == "Struan"]`.

## Experiment 2

### Demographics

```{r}

data_exp_2 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_2 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

results_exp_2_h1 <- data_exp_2 %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS2 eventually shared a color with positive words and CS1 shared a color with negative words, participants showed an automatic relative preference for CS2 over CS1 on the IAT (M = `r format(results_exp_2_h1$summary_stats$mean[results_exp_2_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h1$summary_stats$sd[results_exp_2_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`). whereas when CS2 eventually shared a color with negative words and CS1 shared a color with positive words, they demonstrated a relative preference for CS1 over CS2 (M = `r format(results_exp_2_h1$summary_stats$mean[results_exp_2_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h1$summary_stats$sd[results_exp_2_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_2_h1$t_test_output`, BF10 = `r format(results_exp_2_h1$bf10, nsmall = 2)`.

Note that this result is in the opposite direction to all other experiments.

### H2: Self-report ratings

```{r}

results_exp_2_h2 <- data_exp_2 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

Regardless of whether CS1 eventually shared a color with positive or negative words, participants showed a relative preference on the self-report ratings for CS2 over CS1 (CS1-positive condition: M = `r format(results_exp_2_h2$summary_stats$mean[results_exp_2_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h2$summary_stats$sd[results_exp_2_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`; CS1-negative condition: M = `r format(results_exp_2_h2$summary_stats$mean[results_exp_2_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h2$summary_stats$sd[results_exp_2_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_2_h2$t_test_output`, BF10 = `r format(results_exp_2_h2$bf10, nsmall = 2)`.

Note that this null result is different to all other experiments.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_2$intention <- relevel(as.factor(data_exp_2$intention), ref = "Morag")

results_exp_2_h3 <- data_exp_2 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, but in the opposite direction to that predicted, OR = `r format(results_exp_2_h3$OR[results_exp_2_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_2_h3$OR_ci_lwr[results_exp_2_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_2_h3$OR_ci_upr[results_exp_2_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_2_h3$p[results_exp_2_h3$var == "Struan"]`.

Note that this result is in the opposite direction to all other experiments.

### Distribution of IAT and ratings

Experiment 3 was informed by the unexpected results of experiment 2, which prompted us to examine the distribution of scores on the IAT and self reports which suggested bi- and tri-modality. This is depicted below.

```{r}

data_exp_2 %>%
  select(Participant, source_valence_condition, IAT_Score, EC_Effect_CS1_CS2_Difference_Score) %>%
  rename(`IAT D score` = IAT_Score,
         `Ratings difference score` = EC_Effect_CS1_CS2_Difference_Score) %>%
  gather(dv_modality, dv_score, c(`IAT D score`, `Ratings difference score`)) %>%
  ggplot(aes(dv_score)) +
  geom_density(adjust = 0.5) +
  facet_wrap(~dv_modality+source_valence_condition, scales = "free") +
  theme_classic() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        panel.border = element_blank()) +
  xlab("") +
  ylab("Probability density")

```

## Experiment 3

### Demographics

```{r}

data_exp_3 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_3 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

results_exp_3_h1 <- data_exp_3 %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_3_h1$summary_stats$mean[results_exp_3_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h1$summary_stats$sd[results_exp_3_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_3_h1$summary_stats$mean[results_exp_3_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h1$summary_stats$sd[results_exp_3_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_3_h1$t_test_output`, BF10 = `r format(results_exp_3_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_3_h2 <- data_exp_3 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_3_h2$summary_stats$mean[results_exp_3_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h2$summary_stats$sd[results_exp_3_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_3_h2$summary_stats$mean[results_exp_3_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h2$summary_stats$sd[results_exp_3_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_3_h2$t_test_output`, BF10 = `r format(results_exp_3_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_3$intention <- relevel(as.factor(data_exp_3$intention), ref = "Morag")

results_exp_3_h3 <- data_exp_3 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_3_h3$OR[results_exp_3_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_3_h3$OR_ci_lwr[results_exp_3_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_3_h3$OR_ci_upr[results_exp_3_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_3_h3$p[results_exp_3_h3$var == "Struan"]`.

## Experiment 4 

### Demographics

```{r}

data_exp_4 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_4 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

results_exp_4_h1 <- data_exp_4 %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_4_h1$summary_stats$mean[results_exp_4_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h1$summary_stats$sd[results_exp_4_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_4_h1$summary_stats$mean[results_exp_4_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h1$summary_stats$sd[results_exp_4_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_4_h1$t_test_output`, BF10 = `r format(results_exp_4_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_4_h2 <- data_exp_4 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_4_h2$summary_stats$mean[results_exp_4_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h2$summary_stats$sd[results_exp_4_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_4_h2$summary_stats$mean[results_exp_4_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h2$summary_stats$sd[results_exp_4_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_4_h2$t_test_output`, BF10 = `r format(results_exp_4_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_4$intention <- relevel(as.factor(data_exp_4$intention), ref = "Morag")

results_exp_4_h3 <- data_exp_4 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_4_h3$OR[results_exp_4_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_4_h3$OR_ci_lwr[results_exp_4_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_4_h3$OR_ci_upr[results_exp_4_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_4_h3$p[results_exp_4_h3$var == "Struan"]`.

## Experiment 5

### Demographics

```{r}

data_exp_5 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_5 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

results_exp_5_h1 <- data_exp_5 %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_5_h1$summary_stats$mean[results_exp_5_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h1$summary_stats$sd[results_exp_5_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_5_h1$summary_stats$mean[results_exp_5_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h1$summary_stats$sd[results_exp_5_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_5_h1$t_test_output`, BF10 = `r format(results_exp_5_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_5_h2 <- data_exp_5 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_5_h2$summary_stats$mean[results_exp_5_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h2$summary_stats$sd[results_exp_5_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_5_h2$summary_stats$mean[results_exp_5_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h2$summary_stats$sd[results_exp_5_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_5_h2$t_test_output`, BF10 = `r format(results_exp_5_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_5$intention <- relevel(as.factor(data_exp_5$intention), ref = "Morag")

results_exp_5_h3 <- data_exp_5 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_5_h3$OR[results_exp_5_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_5_h3$OR_ci_lwr[results_exp_5_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_5_h3$OR_ci_upr[results_exp_5_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_5_h3$p[results_exp_5_h3$var == "Struan"]`.

## Experiment 6

### Demographics

```{r}

data_exp_6 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_6 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

results_exp_6_h1 <- data_exp_6 %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_6_h1$summary_stats$mean[results_exp_6_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_6_h1$summary_stats$sd[results_exp_6_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_6_h1$summary_stats$mean[results_exp_6_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_6_h1$summary_stats$sd[results_exp_6_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_6_h1$t_test_output`, BF10 = `r format(results_exp_6_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_6_h2 <- data_exp_6 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_6_h2$summary_stats$mean[results_exp_6_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_6_h2$summary_stats$sd[results_exp_6_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_6_h2$summary_stats$mean[results_exp_6_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_6_h2$summary_stats$sd[results_exp_6_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_6_h2$t_test_output`, BF10 = `r format(results_exp_6_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_6$intention <- relevel(as.factor(data_exp_6$intention), ref = "Morag")

results_exp_6_h3 <- data_exp_6 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_6_h3$OR[results_exp_6_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_6_h3$OR_ci_lwr[results_exp_6_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_6_h3$OR_ci_upr[results_exp_6_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_6_h3$p[results_exp_6_h3$var == "Struan"]`.

## Experiment 7

### Demographics

```{r}

data_exp_7 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age, na.rm = TRUE),
                   age_sd = sd(Age, na.rm = TRUE)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_7 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: Evaluative Priming (Sequential BF)

#### N = 300

These analyses code each trial as being congruent or incongruent based on the valence of the prime and the valence of the source stimulus valence. Mean reaction time was calculated for each participant's congruent and incongruent trials. These means for each trial type are then compared between participants. This represents the classical test of the EP effect. 

```{r}

data_300 <- data_exp_7 %>%
  slice(1:300) %>%
  select(ep_mean_rt_consistent, ep_mean_rt_inconsistent) %>%
  gather()

ttestBF(x = data_300$value[data_300$key == "ep_mean_rt_inconsistent"],
        y = data_300$value[data_300$key == "ep_mean_rt_consistent"],
        paired = TRUE)

sample_300 <- 
  ttestBF(x = data_300$value[data_300$key == "ep_mean_rt_inconsistent"],
          y = data_300$value[data_300$key == "ep_mean_rt_consistent"],
          paired = TRUE,
          posterior = TRUE, 
          iterations = 5000)

data.frame(sample_300) %>%
  dplyr::summarize(mu_median = quantile(mu, prob = .500),
                   mu_lower = quantile(mu, prob = .025),
                   mu_upper = quantile(mu, prob = .975),
                   delta_median = quantile(delta, prob = .500),
                   delta_lower = quantile(delta, prob = .025),
                   delta_upper = quantile(delta, prob = .975)) %>%
  round(2) %>%
  gather(parameter, estimate)

```

#### N = 400

```{r}

data_400 <- data_exp_7 %>%
  slice(1:400) %>%
  select(ep_mean_rt_consistent, ep_mean_rt_inconsistent) %>%
  gather()

ttestBF(x = data_400$value[data_400$key == "ep_mean_rt_inconsistent"],
        y = data_400$value[data_400$key == "ep_mean_rt_consistent"],
        paired = TRUE)

sample_400 <- 
  ttestBF(x = data_400$value[data_400$key == "ep_mean_rt_inconsistent"],
          y = data_400$value[data_400$key == "ep_mean_rt_consistent"],
          paired = TRUE,
          posterior = TRUE, 
          iterations = 5000)

data.frame(sample_400) %>%
  dplyr::summarize(mu_median = quantile(mu, prob = .500),
                   mu_lower = quantile(mu, prob = .025),
                   mu_upper = quantile(mu, prob = .975),
                   delta_median = quantile(delta, prob = .500),
                   delta_lower = quantile(delta, prob = .025),
                   delta_upper = quantile(delta, prob = .975)) %>%
  round(2) %>%
  gather(parameter, estimate)

```

#### N = 500

```{r}

data_500 <- data_exp_7 %>%
  select(ep_mean_rt_consistent, ep_mean_rt_inconsistent) %>%
  gather()

ttestBF(x = data_500$value[data_500$key == "ep_mean_rt_inconsistent"],
        y = data_500$value[data_500$key == "ep_mean_rt_consistent"],
        paired = TRUE)

sample_500 <- 
  ttestBF(x = data_500$value[data_500$key == "ep_mean_rt_inconsistent"],
          y = data_500$value[data_500$key == "ep_mean_rt_consistent"],
          paired = TRUE,
          posterior = TRUE, 
          iterations = 5000)

data.frame(sample_500) %>%
  dplyr::summarize(mu_median = quantile(mu, prob = .500),
                   mu_lower = quantile(mu, prob = .025),
                   mu_upper = quantile(mu, prob = .975),
                   delta_median = quantile(delta, prob = .500),
                   delta_lower = quantile(delta, prob = .025),
                   delta_upper = quantile(delta, prob = .975)) %>%
  round(2) %>%
  gather(parameter, estimate)

```

Frequentist analysis of the final sample for reader familiarity

```{r}

t.test(x = data_500$value[data_500$key == "ep_mean_rt_inconsistent"],
       y = data_500$value[data_500$key == "ep_mean_rt_consistent"],
       paired = TRUE)

effsize::cohen.d(d = data_500$value,
                 f = fct_rev(data_500$key),
                 paired = TRUE)

```

### H2: Self-report ratings

Using the final analytic sample.

```{r}

results_exp_7_h2 <- data_exp_7 %>%
  select(EC_Effect_CS1_CS2_Difference_Score, source_valence_condition) %>%
  na.omit() %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_7_h2$summary_stats$mean[results_exp_7_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_7_h2$summary_stats$sd[results_exp_7_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_7_h2$summary_stats$mean[results_exp_7_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_7_h2$summary_stats$sd[results_exp_7_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_7_h2$t_test_output`, BF10 = `r format(results_exp_7_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

Using the final analytic sample.

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
data_exp_7$intention <- relevel(as.factor(data_exp_7$intention), ref = "Morag")

results_exp_7_h3 <- data_exp_7 %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_7_h3$OR[results_exp_7_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_7_h3$OR_ci_lwr[results_exp_7_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_7_h3$OR_ci_upr[results_exp_7_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_7_h3$p[results_exp_7_h3$var == "Struan"]`.

## Experiment 8

### Demographics

```{r}

data_exp_8 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_8 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### Comparing conditions

Pairwise follow up t-tests using Bonferroni-Holm corrections for multiple testing. 

Results are not parsed into text automatically given the analysis workflow differs from other experiments, and this would take more coding effort than its worth.

#### H1: IAT

```{r}

# anova
fit_exp_8_h1 <- aov(IAT_Score ~ Bag_Matching, 
                    contrasts = "contr.sum",
                    data = data_exp_8)

Anova(fit_exp_8_h1, type = "III")

# effect size
etaSquared(fit_exp_8_h1, type = 2, anova = FALSE )

# follow up t tests
pairwise.t.test(data_exp_8$IAT_Score, 
                data_exp_8$Bag_Matching, 
                p.adj = "holm")

# means by condition
data_exp_8 %>%
  group_by(Bag_Matching) %>%
  dplyr::summarize(mean = mean(IAT_Score),
                   ci_lwr = mean - plotrix::std.error(IAT_Score)*1.96,
                   ci_upr = mean + plotrix::std.error(IAT_Score)*1.96) %>%
  round_df(2)

```

#### H2: Self-report ratings

```{r}

# anova
fit_exp_8_h2 <- aov(EC_Effect_CS1_CS2_Difference_Score ~ Bag_Matching, 
                    contrasts = "contr.sum",
                    data = data_exp_8)

Anova(fit_exp_8_h2, type = "III")

# effect size
etaSquared(fit_exp_8_h2, type = 2, anova = FALSE )

# follow up t tests
pairwise.t.test(data_exp_8$EC_Effect_CS1_CS2_Difference_Score, 
                data_exp_8$Bag_Matching, 
                p.adj = "holm")

# means by condition
data_exp_8 %>%
  group_by(Bag_Matching) %>%
  dplyr::summarize(mean = mean(EC_Effect_CS1_CS2_Difference_Score),
                   ci_lwr = mean - plotrix::std.error(EC_Effect_CS1_CS2_Difference_Score)*1.96,
                   ci_upr = mean + plotrix::std.error(EC_Effect_CS1_CS2_Difference_Score)*1.96) %>%
  round_df(2)

```

### Individual conditions for meta analysis

#### Standard non-random instructions condition

##### H1: IAT

```{r}

results_exp_8nri_h1 <- data_exp_8nri %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_8nri_h1$summary_stats$mean[results_exp_8nri_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_8nri_h1$summary_stats$sd[results_exp_8nri_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_8nri_h1$summary_stats$mean[results_exp_8nri_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_8nri_h1$summary_stats$sd[results_exp_8nri_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_8nri_h1$t_test_output`, BF10 = `r format(results_exp_8nri_h1$bf10, nsmall = 2)`.

##### H2: Self-report ratings

```{r}

results_exp_8nri_h2 <- data_exp_8nri %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_8nri_h2$summary_stats$mean[results_exp_8nri_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_8nri_h2$summary_stats$sd[results_exp_8nri_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_8nri_h2$summary_stats$mean[results_exp_8nri_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_8nri_h2$summary_stats$sd[results_exp_8nri_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_8nri_h2$t_test_output`, BF10 = `r format(results_exp_8nri_h2$bf10, nsmall = 2)`.

#### Random instructions condition for meta analysis

##### H1: IAT

```{r}

results_exp_8ri_h1 <- data_exp_8ri %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_8ri_h1$summary_stats$mean[results_exp_8ri_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_8ri_h1$summary_stats$sd[results_exp_8ri_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_8ri_h1$summary_stats$mean[results_exp_8ri_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_8ri_h1$summary_stats$sd[results_exp_8ri_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_8ri_h1$t_test_output`, BF10 = `r format(results_exp_8ri_h1$bf10, nsmall = 2)`.

##### H2: Self-report ratings

```{r}

results_exp_8ri_h2 <- data_exp_8ri %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_8ri_h2$summary_stats$mean[results_exp_8ri_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_8ri_h2$summary_stats$sd[results_exp_8ri_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_8ri_h2$summary_stats$mean[results_exp_8ri_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_8ri_h2$summary_stats$sd[results_exp_8ri_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_8ri_h2$t_test_output`, BF10 = `r format(results_exp_8ri_h2$bf10, nsmall = 2)`.

## Experiment 9

### Demographics

```{r}

data_exp_9 %>% 
  dplyr::summarize(n = n(),
                   age_mean = mean(Age),
                   age_sd = sd(Age)) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

data_exp_9 %>% 
  dplyr::count(Gender) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

### H1: IAT

```{r}

t.test(data_exp_9$IAT_Score, alternative = "two.sided")

data_exp_9 %>%
  dplyr::summarize(d = round(mean(IAT_Score)/sd(IAT_Score), 2))

# ggplot(data_exp_9, aes(IAT_Score)) +
#   geom_density()

```

### H2: Self-report ratings

```{r}

t.test(data_exp_9$EC_Effect_CS1_CS2_Difference_Score, alternative = "two.sided")

data_exp_9 %>%
  dplyr::summarize(d = round(mean(EC_Effect_CS1_CS2_Difference_Score)/sd(EC_Effect_CS1_CS2_Difference_Score), 2))

# ggplot(data_exp_9, aes(EC_Effect_CS1_CS2_Difference_Score)) +
#   geom_density()

```

# Meta analyses

Meta analyses of experiments 1-8 (nb not 9, which contained no manipulations but acted as an extension of experiment 8).

Random effects meta analyses were fitted using the metafor R package (Viechtbauer, 2010). The maximum liklihood estimator was used.  

A separate meta analysis was fitted for each outcome variable (IAT, self reported ratings, behavioural intentions). Although multivariate meta analysis was a possible alternative (and is conducted in a separate markdown script), previous work has traditionally assessed these dependant variables separately, so we will too.

## Sample sizes

Note that not all variables were collected in all subsets, so sample sizes for subsets do not equal the total sample size * the proportion meeting a given criteria. 

```{r}

total_n_across_studies <- 
  nrow(data_exp_1) + 
  nrow(data_exp_2) +
  nrow(data_exp_3) +
  nrow(data_exp_4) +
  nrow(data_exp_5) +
  nrow(data_exp_6) +
  nrow(data_exp_7) +
  nrow(data_exp_8)

data_combined <- 
  bind_rows(mutate(data_exp_1, experiment = 1),
            mutate(data_exp_2, experiment = 2),
            mutate(data_exp_3, experiment = 3),
            mutate(data_exp_4, experiment = 4),
            mutate(data_exp_5, experiment = 5),
            mutate(data_exp_6, experiment = 6),
            mutate(data_exp_7, experiment = 7),
            mutate(data_exp_8nri, experiment = 8),
            mutate(data_exp_8ri, experiment = 8)) %>%
  select(experiment, US_contingency_memory, color_valence_contingency_memory, 
         demand_IAT, demand_self_reports, hypothesis_awareness, reactance_IAT, reactance_self_reports) %>%
  # fudge to stop "unknown variable" warning from appearing
  mutate(DV = NA)

data_combined %>% 
  dplyr::summarize(full_sample_n = n()) %>%
  round_df(2) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

# percents by subset
temp_1 <- data_combined %>%
  count(US_contingency_memory) %>%
  spread(US_contingency_memory, n) %>%
  mutate(US_contingency_aware = `TRUE` / (`TRUE` + `FALSE`)) %>%
  select(US_contingency_aware)

temp_2 <- data_combined %>%
  count(color_valence_contingency_memory) %>%
  spread(color_valence_contingency_memory, n) %>%
  mutate(color_valence_contingency_aware = `TRUE` / (`TRUE` + `FALSE`)) %>%
  select(color_valence_contingency_aware)

temp_3 <- data_combined %>%
  rowwise() %>%
  mutate(demand = as.logical(max(c(demand_IAT, demand_self_reports)))) %>%
  ungroup() %>%
  count(demand) %>%
  spread(demand, n) %>%
  mutate(NOT_demand_compliant = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(NOT_demand_compliant)

temp_4a <- data_combined %>%
  count(reactance_IAT) %>%
  spread(reactance_IAT, n) %>%
  mutate(NOT_reactant_IAT = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(NOT_reactant_IAT)

temp_4b <- data_combined %>%
  count(reactance_self_reports) %>%
  spread(reactance_self_reports, n) %>%
  mutate(NOT_reactant_self_reports = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(NOT_reactant_self_reports)

temp_5 <- data_combined %>%
  count(hypothesis_awareness) %>%
  spread(hypothesis_awareness, n) %>%
  mutate(NOT_hypothesis_awareness = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(NOT_hypothesis_awareness)

bind_cols(temp_1,
          temp_2,
          temp_3,
          temp_4a,
          temp_4b,
          temp_5) %>%
  gather(subset, proportion) %>%
  round_df(3) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

# percents by subset
temp_1_by_exp <- data_combined %>%
  count(experiment, US_contingency_memory) %>%
  spread(US_contingency_memory, n) %>%
  mutate(US_contingency_aware = `TRUE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, US_contingency_aware)

temp_2_by_exp <- data_combined %>%
  count(experiment, color_valence_contingency_memory) %>%
  spread(color_valence_contingency_memory, n) %>%
  mutate(color_valence_contingency_aware = `TRUE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, color_valence_contingency_aware)

temp_3a_by_exp <- data_combined %>%
  count(experiment, demand_IAT) %>%
  spread(demand_IAT, n) %>%
  mutate(NOT_demand_IAT = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, NOT_demand_IAT)

temp_3b_by_exp <- data_combined %>%
  count(experiment, demand_self_reports) %>%
  spread(demand_self_reports, n) %>%
  mutate(NOT_demand_self_reports = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, NOT_demand_self_reports)

temp_4a_by_exp <- data_combined %>%
  count(experiment, reactance_IAT) %>%
  spread(reactance_IAT, n) %>%
  mutate(NOT_reactant_IAT = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, NOT_reactant_IAT)

temp_4b_by_exp <- data_combined %>%
  count(experiment, reactance_self_reports) %>%
  spread(reactance_self_reports, n) %>%
  mutate(NOT_reactant_self_reports = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, NOT_reactant_self_reports)

temp_5_by_exp <- data_combined %>%
  count(experiment, hypothesis_awareness) %>%
  spread(hypothesis_awareness, n) %>%
  mutate(NOT_hypothesis_awareness = `FALSE` / (`TRUE` + `FALSE`)) %>%
  select(experiment, NOT_hypothesis_awareness)

temp_1_by_exp %>%
  left_join(temp_2_by_exp, by = "experiment") %>%
  left_join(temp_3a_by_exp, by = "experiment") %>%
  left_join(temp_3b_by_exp, by = "experiment") %>%
  left_join(temp_4a_by_exp, by = "experiment") %>%
  left_join(temp_4b_by_exp, by = "experiment") %>%
  left_join(temp_5_by_exp, by = "experiment") %>%
  round_df(3) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

Total N in all studies (for reporting in abstract) = `r total_n_across_studies`.

## Meta analysed effect size

Notes on meta analysed effect size:

Credibility intervals refer to the interval of effect sizes likely to be observed in a future study on the basis of the width of estimation of the true effect size combined with variation in this true effect size (e.g., due to heterogeneity). 

Notes on heterogeneity metrics:

- Q and its p value: A measure of weighted squared deviations. Depends on number of studies.
- tau^2: Population between-studies variance, ie estimated amount of total true heterogeneity in the effect. Is on the same scale as the meta analysed effect size, and so cannot be compared between meta analysis using different scales (e.g., Cohen's d vs. Odds Ratios).
- I^2: Percentage of variation in the observed effects that is due to true heterogeneity (as quantified by tau^2) as opposed to sampling variation. Metric is therefore a description of data in sample, not an underlying quality associated with the true effect. Can be thought of as analogous to the reliability of a scale, which also represents the percentage of true variance as portion of total variance. Range 0-100, lower values preferable. E.g., 0 = no variability in observed effects to be explained as a systematic influence (e.g., some due to some moderator) as its all just sampling variation. Does not depend on the effect size scale or the number of studies.
- H^2: Total variability / sampling variability, i.e., (true variability / sampling variability)/sampling variability. Lower values preferable, i.e., refer to less true variation to be explained as systematic (e.g., due to some moderator).

### H1: IAT

```{r}

results_for_meta_analysis_h1 <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h1$cohens_d$estimate[[1]], 
                          results_exp_2_h1$cohens_d$estimate[[1]], 
                          results_exp_3_h1$cohens_d$estimate[[1]], 
                          results_exp_4_h1$cohens_d$estimate[[1]],
                          results_exp_5_h1$cohens_d$estimate[[1]],
                          results_exp_6_h1$cohens_d$estimate[[1]],
                          results_exp_8nri_h1$cohens_d$estimate[[1]], 
                          results_exp_8ri_h1$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1$cohens_d$conf.int[["lower"]],
                        results_exp_6_h1$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h1$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h1$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1$cohens_d$conf.int[["upper"]],
                        results_exp_6_h1$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h1$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h1$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2))

results_for_meta_analysis_h1 %>%
  select(Experiment, yi, sei) %>%
  write_csv("../meta analysis data/results_for_meta_analysis_iat.csv")

meta_results_h1 <- meta_analysis_workflow(data              = results_for_meta_analysis_h1,
                                          effect_size_label = "Cohen's d",
                                          exp_estimates     = FALSE,
                                          reference_line    = 0)

```

- Results demonstrated a significant effect of medium size (Cohen, 1988): `r meta_results_h1$meta_analysis_results_text`
- Results were found to contain a high degree of heterogeneity: `r meta_results_h1$heterogeneity_test_results_text`

#### Outlier tests

[Undue influence](https://rdrr.io/cran/metafor/man/influence.rma.uni.html) of one or more studies on either the meta analysed effect size or the heterogeneity among studies was then assessed.

Note on influence metrics from the metafor package documentation:

- The DFFITS value indicates how many standard deviations the predicted (average) effect for the ith study changes after excluding the ith study from the model fitting.
- The leave-one-out amount of (residual) heterogeneity is the estimated value of <c2><b2> based on the dataset with the ith study removed. Note that this is always equal to 0 for fixed-effects models.
- Similarly, the leave-one-out test statistic for the test of (residual) heterogeneity is the value of the test statistic of the test for (residual) heterogeneity calculated based on the dataset with the ith study removed.

Outliers were assessed on the baiss of undue influence, on the predicted average effect size/coefficients (DFFITS), and the large decrease in heterogeneity on the basis of its removal (tau2.del, QE.del). Note that outliers were also selected based on consistency across all three DVs (see other analyses below).

```{r fig.height=8, fig.width=4}

influence_meta_results_h1 <- influence(meta_results_h1$fitted_model)

print(influence_meta_results_h1, digits = 2) 

```

Experiment 2 was assessed as being an outlier. 

####  Sensitivity analysis

A sensitivity analysis therefore excluded Experiment 2 and re meta analysed. 

```{r}

results_for_meta_analysis_h1_sensitivity <- results_for_meta_analysis_h1 %>%
  filter(Experiment != "Experiment 2")

meta_results_h1_sensitivity <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_sensitivity,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0)

```

- After excluding one experiment as an outlier, the meta analysed effect size was found to be of large size: `r meta_results_h1_sensitivity$meta_analysis_results_text`, and heterogeneity was found to lower, `r meta_results_h1_sensitivity$heterogeneity_test_results_text`.

### H2: Self-report ratings

```{r}

results_for_meta_analysis_h2 <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 7",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"),
             cohens_d = c(results_exp_1_h2$cohens_d$estimate[[1]], 
                          results_exp_2_h2$cohens_d$estimate[[1]], 
                          results_exp_3_h2$cohens_d$estimate[[1]], 
                          results_exp_4_h2$cohens_d$estimate[[1]],
                          results_exp_5_h2$cohens_d$estimate[[1]],
                          results_exp_6_h2$cohens_d$estimate[[1]],
                          results_exp_7_h2$cohens_d$estimate[[1]],
                          results_exp_8nri_h2$cohens_d$estimate[[1]],
                          results_exp_8ri_h2$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2$cohens_d$conf.int[["lower"]],
                        results_exp_6_h2$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h2$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2$cohens_d$conf.int[["upper"]],
                        results_exp_6_h2$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h2$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2))

results_for_meta_analysis_h2 %>%
  select(Experiment, yi, sei) %>%
  write_csv("../meta analysis data/results_for_meta_analysis_self_report.csv")

meta_results_h2 <- meta_analysis_workflow(data              = results_for_meta_analysis_h2,
                                          effect_size_label = "Cohen's d",
                                          exp_estimates     = FALSE,
                                          reference_line    = 0)

```

- Results demonstrated a significant effect of large size: `r meta_results_h2$meta_analysis_results_text`
- Results were found to contain a high degree of heterogeneity: `r meta_results_h2$heterogeneity_test_results_text`

#### Outlier tests

```{r fig.height=8, fig.width=4}

influence_meta_results_h2 <- influence(meta_results_h2$fitted_model)

print(influence_meta_results_h2, digits = 2) 

```

Experiment 2 was assessed as being an outlier. 

####  Sensitivity analysis

A sensitivity analysis excluded Experiment 2 and re meta analysed. 

```{r}

results_for_meta_analysis_h2_sensitivity <- results_for_meta_analysis_h2 %>%
  filter(Experiment != "Experiment 2")

meta_results_h2_sensitivity <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_sensitivity,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0)

```

- After excluding one experiment as an outlier, the meta analysed effect size was found to be of very large size (Sawilowsky, 2009): `r meta_results_h2_sensitivity$meta_analysis_results_text`, and heterogeneity was found to very negligable, `r meta_results_h2_sensitivity$heterogeneity_test_results_text`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

results_for_meta_analysis_h3 <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", 
                            "Experiment 5", "Experiment 6", "Experiment 7"),
             logOR = c(results_exp_1_h3$logOR[results_exp_1_h3$var == "Struan"], 
                       results_exp_2_h3$logOR[results_exp_2_h3$var == "Struan"],
                       results_exp_3_h3$logOR[results_exp_3_h3$var == "Struan"],
                       results_exp_4_h3$logOR[results_exp_4_h3$var == "Struan"],
                       results_exp_5_h3$logOR[results_exp_5_h3$var == "Struan"],
                       results_exp_6_h3$logOR[results_exp_6_h3$var == "Struan"],
                       results_exp_7_h3$logOR[results_exp_7_h3$var == "Struan"]),
             logOR_se = c(results_exp_1_h3$logOR_se[results_exp_1_h3$var == "Struan"],
                          results_exp_2_h3$logOR_se[results_exp_2_h3$var == "Struan"],
                          results_exp_3_h3$logOR_se[results_exp_3_h3$var == "Struan"],
                          results_exp_4_h3$logOR_se[results_exp_4_h3$var == "Struan"],
                          results_exp_5_h3$logOR_se[results_exp_5_h3$var == "Struan"],
                          results_exp_6_h3$logOR_se[results_exp_6_h3$var == "Struan"],
                          results_exp_7_h3$logOR_se[results_exp_7_h3$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se)

results_for_meta_analysis_h3 %>%
  select(Experiment, yi, sei) %>%
  write_csv("../meta analysis data/results_for_meta_analysis_behavioural_intentions.csv")

meta_results_h3 <- meta_analysis_workflow(data = results_for_meta_analysis_h3,
                                          effect_size_label = "Odds Ratio",
                                          exp_estimates     = TRUE,
                                          reference_line    = 0)

```

- Results demonstrated a significant effect of medium size (Chen, Cohen, & Chen, 2010): `r meta_results_h3$meta_analysis_results_text`
- Results were found to contain a high degree of heterogeneity: `r meta_results_h3$heterogeneity_test_results_text`

#### Outlier tests

```{r fig.height=8, fig.width=4}

influence_meta_results_h3 <- influence(meta_results_h3$fitted_model)

print(influence_meta_results_h3, digits = 2) 

```

Experiment 2 was assessed as being an outlier. 

####  Sensitivity analysis

A sensitivity analysis excluded Experiment 2 and re meta analysed. 

```{r}

results_for_meta_analysis_h3_sensitivity <- results_for_meta_analysis_h3 %>%
  filter(Experiment != "Experiment 2")

meta_results_h3_sensitivity <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h3_sensitivity,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0)

```

- After excluding one experiment as an outlier, the meta analysed effect size was found to be of large size: `r meta_results_h3_sensitivity$meta_analysis_results_text`, and heterogeneity was found to be negligable, `r meta_results_h3_sensitivity$heterogeneity_test_results_text`.

## Robustness tests via meta analyses

### H1: IAT

Refit meta analyses after excluding subsets of participants based on the exploratory awareness variables. 

Note that these robustness tests also take the influence tests into account by excluding Experiment 2. 

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
## exp 1
results_exp_1_h1_us_contingency_memory <- data_exp_1 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h1_color_valence_contingency_memory <- data_exp_1 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h1_demand_compliance <- data_exp_1 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h1_reactance_IAT <- data_exp_1 %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 2
results_exp_2_h1_us_contingency_memory <- data_exp_2 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h1_color_valence_contingency_memory <- data_exp_2 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h1_demand_compliance <- data_exp_2 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h1_reactance_IAT <- data_exp_2 %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 3
results_exp_3_h1_us_contingency_memory <- data_exp_3 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h1_color_valence_contingency_memory <- data_exp_3 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h1_demand_compliance <- data_exp_3 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h1_reactance_IAT <- data_exp_3 %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 4
results_exp_4_h1_us_contingency_memory <- data_exp_4 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h1_color_valence_contingency_memory <- data_exp_4 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h1_demand_compliance <- data_exp_4 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h1_reactance_IAT <- data_exp_4 %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 5
results_exp_5_h1_us_contingency_memory <- data_exp_5 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h1_color_valence_contingency_memory <- data_exp_5 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h1_demand_compliance <- data_exp_5 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h1_reactance_IAT <- data_exp_5 %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 6
results_exp_6_h1_demand_compliance <- data_exp_6 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_6_h1_reactance_IAT <- data_exp_6 %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 standard instructions
results_exp_8nri_h1_us_contingency_memory <- data_exp_8nri %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8nri_h1_demand_compliance <- data_exp_8nri %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8nri_h1_reactance_IAT <- data_exp_8nri %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 random instructions
results_exp_8ri_h1_us_contingency_memory <- data_exp_8ri %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8ri_h1_demand_compliance <- data_exp_8ri %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8ri_h1_reactance_IAT <- data_exp_8ri %>%
  filter(reactance_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

# US contingency_memory
results_for_meta_analysis_h1_us_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h1_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_2_h1_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_3_h1_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_4_h1_us_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_5_h1_us_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_8nri_h1_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_8ri_h1_us_contingency_memory$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h1_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h1_us_contingency_memory$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h1_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h1_us_contingency_memory$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# color valence contingency_memory
results_for_meta_analysis_h1_color_valence_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5"), 
             cohens_d = c(results_exp_1_h1_color_valence_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_2_h1_color_valence_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_3_h1_color_valence_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_4_h1_color_valence_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_5_h1_color_valence_contingency_memory$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_color_valence_contingency_memory$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_color_valence_contingency_memory$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# demand_compliance
results_for_meta_analysis_h1_demand_compliance <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_2_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_3_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_4_h1_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_5_h1_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_6_h1_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_8nri_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_8ri_h1_demand_compliance$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_6_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h1_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h1_demand_compliance$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_6_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h1_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h1_demand_compliance$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# reactance
results_for_meta_analysis_h1_reactance_IAT <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h1_reactance_IAT$cohens_d$estimate[[1]], 
                          results_exp_2_h1_reactance_IAT$cohens_d$estimate[[1]], 
                          results_exp_3_h1_reactance_IAT$cohens_d$estimate[[1]], 
                          results_exp_4_h1_reactance_IAT$cohens_d$estimate[[1]],
                          results_exp_5_h1_reactance_IAT$cohens_d$estimate[[1]],
                          results_exp_6_h1_reactance_IAT$cohens_d$estimate[[1]],
                          results_exp_8nri_h1_reactance_IAT$cohens_d$estimate[[1]], 
                          results_exp_8ri_h1_reactance_IAT$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_6_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h1_reactance_IAT$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h1_reactance_IAT$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_6_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h1_reactance_IAT$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h1_reactance_IAT$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# fit metas
meta_results_h1_us_contingency_memory <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_us_contingency_memory,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h1_color_valence_contingency_memory <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_color_valence_contingency_memory,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h1_demand_compliance <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_demand_compliance,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h1_reactance_IAT <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_reactance_IAT,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

# robustness strings
robustness_us_contingency_memory_h1 <-
  ifelse(robust_test(meta_results_h1_us_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_color_valence_contingency_memory_h1 <-
  ifelse(robust_test(meta_results_h1_color_valence_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_demand_compliance_h1  <-
  ifelse(robust_test(meta_results_h1_demand_compliance$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_reactance_IAT_excluded_h1    <-
  ifelse(robust_test(meta_results_h1_reactance_IAT$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

```

- Across studies, results `r robustness_us_contingency_memory_h1` robust to including only participants who were US contingency aware, p in subsample `r meta_results_h1_us_contingency_memory$meta_analysis_results$estimate[meta_results_h1_us_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_color_valence_contingency_memory_h1` robust to including only participants who were color-valence contingency aware, p in subsample `r meta_results_h1_color_valence_contingency_memory$meta_analysis_results$estimate[meta_results_h1_color_valence_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_demand_compliance_h1` robust to including only participants who were not demand compliant, p in subsample `r meta_results_h1_demand_compliance$meta_analysis_results$estimate[meta_results_h1_demand_compliance$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_reactance_IAT_excluded_h1` robust to including only participants who were not reactant, p in subsample `r meta_results_h1_reactance_IAT$meta_analysis_results$estimate[meta_results_h1_reactance_IAT$meta_analysis_results$metric == "p"]`.

### H2: Self-report ratings

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
## exp 1
results_exp_1_h2_us_contingency_memory <- data_exp_1 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h2_color_valence_contingency_memory <- data_exp_1 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h2_demand_compliance <- data_exp_1 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h2_reactance_self_reports <- data_exp_1 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 2
results_exp_2_h2_us_contingency_memory <- data_exp_2 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h2_color_valence_contingency_memory <- data_exp_2 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h2_demand_compliance <- data_exp_2 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h2_reactance_self_reports <- data_exp_2 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 3
results_exp_3_h2_us_contingency_memory <- data_exp_3 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h2_color_valence_contingency_memory <- data_exp_3 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h2_demand_compliance <- data_exp_3 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h2_reactance_self_reports <- data_exp_3 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 4
results_exp_4_h2_us_contingency_memory <- data_exp_4 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h2_color_valence_contingency_memory <- data_exp_4 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h2_demand_compliance <- data_exp_4 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h2_reactance_self_reports <- data_exp_4 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 5
results_exp_5_h2_us_contingency_memory <- data_exp_5 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h2_color_valence_contingency_memory <- data_exp_5 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h2_demand_compliance <- data_exp_5 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h2_reactance_self_reports <- data_exp_5 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 6
results_exp_6_h2_demand_compliance <- data_exp_6 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_6_h2_reactance_self_reports <- data_exp_6 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 7
results_exp_7_h2_us_contingency_memory <- data_exp_7 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_7_h2_color_valence_contingency_memory <- data_exp_7 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_7_h2_demand_compliance <- data_exp_7 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_7_h2_reactance_self_reports <- data_exp_7 %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 standard instructions
results_exp_8nri_h2_us_contingency_memory <- data_exp_8nri %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8nri_h2_demand_compliance <- data_exp_8nri %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8nri_h2_reactance_self_reports <- data_exp_8nri %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 random instructions
results_exp_8ri_h2_us_contingency_memory <- data_exp_8ri %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8ri_h2_demand_compliance <- data_exp_8ri %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8ri_h2_reactance_self_reports <- data_exp_8ri %>%
  filter(reactance_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


# US contingency_memory
results_for_meta_analysis_h2_us_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", 
                            "Experiment 7",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h2_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_2_h2_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_3_h2_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_4_h2_us_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_5_h2_us_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_7_h2_us_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_8nri_h2_us_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_8ri_h2_us_contingency_memory$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h2_us_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2_us_contingency_memory$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h2_us_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2_us_contingency_memory$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# color valence contingency_memory
results_for_meta_analysis_h2_color_valence_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", 
                            "Experiment 7"), 
             cohens_d = c(results_exp_1_h2_color_valence_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_2_h2_color_valence_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_3_h2_color_valence_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_4_h2_color_valence_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_5_h2_color_valence_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_7_h2_color_valence_contingency_memory$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_color_valence_contingency_memory$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_color_valence_contingency_memory$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_color_valence_contingency_memory$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_color_valence_contingency_memory$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# demand_compliance
results_for_meta_analysis_h2_demand_compliance <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 7",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_2_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_3_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_4_h2_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_5_h2_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_6_h2_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_7_h2_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_8nri_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_8ri_h2_demand_compliance$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_6_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h2_demand_compliance$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2_demand_compliance$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_6_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h2_demand_compliance$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2_demand_compliance$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# reactance_self_reports
results_for_meta_analysis_h2_reactance_self_reports <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 7",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h2_reactance_self_reports$cohens_d$estimate[[1]], 
                          results_exp_2_h2_reactance_self_reports$cohens_d$estimate[[1]], 
                          results_exp_3_h2_reactance_self_reports$cohens_d$estimate[[1]], 
                          results_exp_4_h2_reactance_self_reports$cohens_d$estimate[[1]],
                          results_exp_5_h2_reactance_self_reports$cohens_d$estimate[[1]],
                          results_exp_6_h2_reactance_self_reports$cohens_d$estimate[[1]],
                          results_exp_7_h2_reactance_self_reports$cohens_d$estimate[[1]],
                          results_exp_8nri_h2_reactance_self_reports$cohens_d$estimate[[1]], 
                          results_exp_8ri_h2_reactance_self_reports$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_6_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h2_reactance_self_reports$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2_reactance_self_reports$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_6_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h2_reactance_self_reports$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2_reactance_self_reports$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# fit metas
meta_results_h2_us_contingency_memory <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_us_contingency_memory,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h2_color_valence_contingency_memory <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_color_valence_contingency_memory,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h2_demand_compliance <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_demand_compliance,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h2_reactance_self_reports <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_reactance_self_reports,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

# robustness strings
robustness_us_contingency_memory_h2 <-
  ifelse(robust_test(meta_results_h2_us_contingency_memory$meta_analysis_results, 
                     meta_results_h2$meta_analysis_results),
         "were", "were not")

robustness_color_valence_contingency_memory_h2 <-
  ifelse(robust_test(meta_results_h2_color_valence_contingency_memory$meta_analysis_results, 
                     meta_results_h2$meta_analysis_results),
         "were", "were not")

robustness_demand_compliance_h2  <-
  ifelse(robust_test(meta_results_h2_demand_compliance$meta_analysis_results, 
                     meta_results_h2$meta_analysis_results),
         "were", "were not")

robustness_reactance_self_reports_h2    <-
  ifelse(robust_test(meta_results_h2_reactance_self_reports$meta_analysis_results, 
                     meta_results_h2$meta_analysis_results),
         "were", "were not")

```

- Across studies, results `r robustness_us_contingency_memory_h2` robust to including only participants who were US contingency aware, p in subsample `r meta_results_h2_us_contingency_memory$meta_analysis_results$estimate[meta_results_h2_us_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_color_valence_contingency_memory_h2` robust to including only participants who were color-valence contingency aware, p in subsample `r meta_results_h2_color_valence_contingency_memory$meta_analysis_results$estimate[meta_results_h2_color_valence_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_demand_compliance_h2` robust to including only participants who were not demand compliant, p in subsample `r meta_results_h2_demand_compliance$meta_analysis_results$estimate[meta_results_h2_demand_compliance$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_reactance_self_reports_h2` robust to including only participants who were not reactant, p in subsample `r meta_results_h2_reactance_self_reports$meta_analysis_results$estimate[meta_results_h2_reactance_self_reports$meta_analysis_results$metric == "p"]`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
# exp 1
results_exp_1_h3_us_contingency_memory <- data_exp_1 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_1_h3_color_valence_contingency_memory <- data_exp_1 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 2
results_exp_2_h3_us_contingency_memory <- data_exp_2 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_2_h3_color_valence_contingency_memory <- data_exp_2 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 3
results_exp_3_h3_us_contingency_memory <- data_exp_3 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_3_h3_color_valence_contingency_memory <- data_exp_3 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 4
results_exp_4_h3_us_contingency_memory <- data_exp_4 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_4_h3_color_valence_contingency_memory <- data_exp_4 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 5
results_exp_5_h3_us_contingency_memory <- data_exp_5 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_5_h3_color_valence_contingency_memory <- data_exp_5 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 7
results_exp_7_h3_us_contingency_memory <- data_exp_7 %>%
  filter(US_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_7_h3_color_valence_contingency_memory <- data_exp_7 %>%
  filter(color_valence_contingency_memory == TRUE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# us contingency memory
results_for_meta_analysis_h3_us_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", 
                            "Experiment 5", "Experiment 7"),
             logOR = c(results_exp_1_h3_us_contingency_memory$logOR[results_exp_1_h3_us_contingency_memory$var == "Struan"], 
                       results_exp_2_h3_us_contingency_memory$logOR[results_exp_2_h3_us_contingency_memory$var == "Struan"],
                       results_exp_3_h3_us_contingency_memory$logOR[results_exp_3_h3_us_contingency_memory$var == "Struan"],
                       results_exp_4_h3_us_contingency_memory$logOR[results_exp_4_h3_us_contingency_memory$var == "Struan"],
                       results_exp_5_h3_us_contingency_memory$logOR[results_exp_5_h3_us_contingency_memory$var == "Struan"],
                       results_exp_7_h3_us_contingency_memory$logOR[results_exp_7_h3_us_contingency_memory$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_us_contingency_memory$logOR_se[results_exp_1_h3_us_contingency_memory$var == "Struan"],
                          results_exp_2_h3_us_contingency_memory$logOR_se[results_exp_2_h3_us_contingency_memory$var == "Struan"],
                          results_exp_3_h3_us_contingency_memory$logOR_se[results_exp_3_h3_us_contingency_memory$var == "Struan"],
                          results_exp_4_h3_us_contingency_memory$logOR_se[results_exp_4_h3_us_contingency_memory$var == "Struan"],
                          results_exp_5_h3_us_contingency_memory$logOR_se[results_exp_5_h3_us_contingency_memory$var == "Struan"],
                          results_exp_7_h3_us_contingency_memory$logOR_se[results_exp_7_h3_us_contingency_memory$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# color valence contingency memory
results_for_meta_analysis_h3_color_valence_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", 
                            "Experiment 5", "Experiment 7"),
             logOR = c(results_exp_1_h3_color_valence_contingency_memory$logOR[results_exp_1_h3_color_valence_contingency_memory$var == "Struan"], 
                       results_exp_2_h3_color_valence_contingency_memory$logOR[results_exp_2_h3_color_valence_contingency_memory$var == "Struan"],
                       results_exp_3_h3_color_valence_contingency_memory$logOR[results_exp_3_h3_color_valence_contingency_memory$var == "Struan"],
                       results_exp_4_h3_color_valence_contingency_memory$logOR[results_exp_4_h3_color_valence_contingency_memory$var == "Struan"],
                       results_exp_5_h3_color_valence_contingency_memory$logOR[results_exp_5_h3_color_valence_contingency_memory$var == "Struan"],
                       results_exp_7_h3_color_valence_contingency_memory$logOR[results_exp_7_h3_color_valence_contingency_memory$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_color_valence_contingency_memory$logOR_se[results_exp_1_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_2_h3_color_valence_contingency_memory$logOR_se[results_exp_2_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_3_h3_color_valence_contingency_memory$logOR_se[results_exp_3_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_4_h3_color_valence_contingency_memory$logOR_se[results_exp_4_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_5_h3_color_valence_contingency_memory$logOR_se[results_exp_5_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_7_h3_color_valence_contingency_memory$logOR_se[results_exp_7_h3_color_valence_contingency_memory$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# meta fits
meta_results_h3_us_contingency_memory <- 
  meta_analysis_workflow(data = results_for_meta_analysis_h3_us_contingency_memory,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h3_color_valence_contingency_memory <- 
  meta_analysis_workflow(data = results_for_meta_analysis_h3_color_valence_contingency_memory,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0,
                         plot = FALSE)

# robustness strings
robustness_us_contingency_memory_h3 <-
  ifelse(robust_test(meta_results_h3_us_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_color_valence_contingency_memory_h3 <-
  ifelse(robust_test(meta_results_h3_color_valence_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

```

- Across studies, results `r robustness_us_contingency_memory_h3` robust to including only participants who were US contingency aware, p in subsample `r meta_results_h3_us_contingency_memory$meta_analysis_results$estimate[meta_results_h3_us_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_color_valence_contingency_memory_h3` robust to including only participants who were color-valence contingency aware, p in subsample `r meta_results_h3_color_valence_contingency_memory$meta_analysis_results$estimate[meta_results_h3_color_valence_contingency_memory$meta_analysis_results$metric == "p"]`.

## Moderation analyses

Our robustness analyses exclude participants who meet certain criteria. A reviewer requested that we also calculate modration by these variables. 

### H1: IAT

Note that these tests also take the influence tests into account by excluding Experiment 2. 

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
## exp 1
results_exp_1_h1_us_contingency_memory_excluded <- data_exp_1 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h1_color_valence_contingency_memory_excluded <- data_exp_1 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h1_demand_compliance_excluded <- data_exp_1 %>%
  filter(demand_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h1_reactance_IAT_excluded <- data_exp_1 %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 2
results_exp_2_h1_us_contingency_memory_excluded <- data_exp_2 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h1_color_valence_contingency_memory_excluded <- data_exp_2 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h1_demand_compliance_excluded <- data_exp_2 %>%
  filter(demand_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h1_reactance_IAT_excluded <- data_exp_2 %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 3
results_exp_3_h1_us_contingency_memory_excluded <- data_exp_3 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h1_color_valence_contingency_memory_excluded <- data_exp_3 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h1_demand_compliance_excluded <- data_exp_3 %>%
  filter(demand_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h1_reactance_IAT_excluded <- data_exp_3 %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 4
results_exp_4_h1_us_contingency_memory_excluded <- data_exp_4 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h1_color_valence_contingency_memory_excluded <- data_exp_4 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h1_demand_compliance_excluded <- data_exp_4 %>%
  filter(demand_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h1_reactance_IAT_excluded <- data_exp_4 %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 5
results_exp_5_h1_us_contingency_memory_excluded <- data_exp_5 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h1_color_valence_contingency_memory_excluded <- data_exp_5 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h1_demand_compliance_excluded <- data_exp_5 %>%
  filter(demand_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h1_reactance_IAT_excluded <- data_exp_5 %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

# ## exp 6
# results_exp_6_h1_demand_compliance_excluded <- data_exp_6 %>%
#   filter(demand_IAT == TRUE) %>%
#   mutate(DV = IAT_Score,
#          IV = source_valence_condition) %>%
#   t_test_analyses(.)
#>not enough 'x' observations

results_exp_6_h1_reactance_IAT_excluded <- data_exp_6 %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 standard instructions
# results_exp_8nri_h1_us_contingency_memory_excluded <- data_exp_8nri %>%
#   filter(US_contingency_memory == FALSE) %>%
#   mutate(DV = IAT_Score,
#          IV = source_valence_condition) %>%
#   t_test_analyses(.)
#>not enough 'x' observations

# results_exp_8nri_h1_demand_compliance_excluded <- data_exp_8nri %>%
#   filter(demand_IAT == TRUE) %>%
#   mutate(DV = IAT_Score,
#          IV = source_valence_condition) %>%
#   t_test_analyses(.)
#>not enough 'x' observations

results_exp_8nri_h1_reactance_IAT_excluded <- data_exp_8nri %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 random instructions
results_exp_8ri_h1_us_contingency_memory_excluded <- data_exp_8ri %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

# results_exp_8ri_h1_demand_compliance_excluded <- data_exp_8ri %>%
#   filter(demand_IAT == TRUE) %>%
#   distinct(source_valence_condition)
#   mutate(DV = IAT_Score,
#          IV = source_valence_condition) %>%
#   t_test_analyses(.)
# not enough 'x' observations

results_exp_8ri_h1_reactance_IAT_excluded <- data_exp_8ri %>%
  filter(reactance_IAT == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

# US contingency_memory
results_for_meta_analysis_h1_us_contingency_memory_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5",
                            #"Experiment 8 (standard)", 
                            "Experiment 8 (random)"),
             cohens_d = c(results_exp_1_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]],
                          #results_exp_8nri_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_8ri_h1_us_contingency_memory_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        #results_exp_8nri_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h1_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        #results_exp_8nri_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h1_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# color valence contingency_memory
results_for_meta_analysis_h1_color_valence_contingency_memory_excluded <- 
  data.frame(Experiment = c("Experiment 1", 
                            "Experiment 2", 
                            "Experiment 3", 
                            "Experiment 4", 
                            "Experiment 5"), 
             cohens_d = c(results_exp_1_h1_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h1_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h1_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h1_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h1_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# demand_compliance
results_for_meta_analysis_h1_demand_compliance_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5"), 
             #"Experiment 6",
             #"Experiment 8 (standard)"), 
             #"Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h1_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h1_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h1_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h1_demand_compliance_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h1_demand_compliance_excluded$cohens_d$estimate[[1]]),
             #results_exp_6_h1_demand_compliance_excluded_excluded$cohens_d$estimate[[1]],
             #results_exp_8nri_h1_demand_compliance_excluded$cohens_d$estimate[[1]]), 
             #results_exp_8ri_h1_demand_compliance_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]]),
             #results_exp_6_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
             #results_exp_8nri_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]]),
             #results_exp_8ri_h1_demand_compliance_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_demand_compliance_excluded$cohens_d$conf.int[["upper"]])) %>%
  #results_exp_6_h1_demand_compliance_excluded$cohens_d_excluded$conf.int[["upper"]],
  #results_exp_8nri_h1_demand_compliance_excluded$cohens_d$conf.int[["upper"]])) %>%
  #results_exp_8ri_h1_demand_compliance_excluded$cohens_d_excluded$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# reactance
results_for_meta_analysis_h1_reactance_IAT_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h1_reactance_IAT_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h1_reactance_IAT_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h1_reactance_IAT_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h1_reactance_IAT_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h1_reactance_IAT_excluded$cohens_d$estimate[[1]],
                          results_exp_6_h1_reactance_IAT_excluded$cohens_d$estimate[[1]],
                          results_exp_8nri_h1_reactance_IAT_excluded$cohens_d$estimate[[1]], 
                          results_exp_8ri_h1_reactance_IAT_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_6_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h1_reactance_IAT_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_6_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h1_reactance_IAT_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# fit metas
mod_meta_results_h1_us_contingency_memory <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h1_us_contingency_memory, exclude = FALSE),
                                                              results_for_meta_analysis_h1_us_contingency_memory_excluded,
                                                              by = "Experiment"), 
                                                    results_for_meta_analysis_h1_us_contingency_memory_excluded),
                                   effect_size_label = "Cohen's d")

mod_meta_results_h1_color_valence_contingency_memory <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h1_color_valence_contingency_memory, exclude = FALSE),
                                                              results_for_meta_analysis_h1_color_valence_contingency_memory_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h1_color_valence_contingency_memory_excluded),
                                   effect_size_label = "Cohen's d")

mod_meta_results_h1_demand_compliance <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h1_demand_compliance, exclude = FALSE),
                                                              results_for_meta_analysis_h1_demand_compliance_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h1_demand_compliance_excluded),
                                   effect_size_label = "Cohen's d")

mod_meta_results_h1_reactance <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h1_reactance_IAT, exclude = FALSE),
                                                              results_for_meta_analysis_h1_reactance_IAT_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h1_reactance_IAT_excluded),
                                   effect_size_label = "Cohen's d")

# forest plots
forest(mod_meta_results_h1_us_contingency_memory$fitted_model)
forest(mod_meta_results_h1_color_valence_contingency_memory$fitted_model)
forest(mod_meta_results_h1_demand_compliance$fitted_model)
forest(mod_meta_results_h1_reactance$fitted_model)

```

Moderation by:

- US contingency memory (TRUE were excluded): `r mod_meta_results_h1_us_contingency_memory$mod_meta_analysis_results_text`
- color-valence contingency memory (TRUE were excluded): `r mod_meta_results_h1_color_valence_contingency_memory$mod_meta_analysis_results_text`
- demand compliance (FALSE were excluded): `r mod_meta_results_h1_demand_compliance$mod_meta_analysis_results_text`
- reactance (FALSE were excluded): `r mod_meta_results_h1_reactance$mod_meta_analysis_results_text`

### H2: Self-report ratings

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
## exp 1
results_exp_1_h2_us_contingency_memory_excluded <- data_exp_1 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h2_color_valence_contingency_memory_excluded <- data_exp_1 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h2_demand_compliance_excluded <- data_exp_1 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_1_h2_reactance_self_reports_excluded <- data_exp_1 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 2
results_exp_2_h2_us_contingency_memory_excluded <- data_exp_2 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h2_color_valence_contingency_memory_excluded <- data_exp_2 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h2_demand_compliance_excluded <- data_exp_2 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_2_h2_reactance_self_reports_excluded <- data_exp_2 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 3
results_exp_3_h2_us_contingency_memory_excluded <- data_exp_3 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h2_color_valence_contingency_memory_excluded <- data_exp_3 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h2_demand_compliance_excluded <- data_exp_3 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_3_h2_reactance_self_reports_excluded <- data_exp_3 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 4
results_exp_4_h2_us_contingency_memory_excluded <- data_exp_4 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h2_color_valence_contingency_memory_excluded <- data_exp_4 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h2_demand_compliance_excluded <- data_exp_4 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_4_h2_reactance_self_reports_excluded <- data_exp_4 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 5
results_exp_5_h2_us_contingency_memory_excluded <- data_exp_5 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h2_color_valence_contingency_memory_excluded <- data_exp_5 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h2_demand_compliance_excluded <- data_exp_5 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_5_h2_reactance_self_reports_excluded <- data_exp_5 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

## exp 6
results_exp_6_h2_demand_compliance_excluded <- data_exp_6 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_6_h2_reactance_self_reports_excluded <- data_exp_6 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 7
results_exp_7_h2_us_contingency_memory_excluded <- data_exp_7 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_7_h2_color_valence_contingency_memory_excluded <- data_exp_7 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_7_h2_demand_compliance_excluded <- data_exp_7 %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_7_h2_reactance_self_reports_excluded <- data_exp_7 %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 standard instructions
# results_exp_8nri_h2_us_contingency_memory_excluded <- data_exp_8nri %>%
#   filter(US_contingency_memory == FALSE) %>%
#   mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
#          IV = source_valence_condition) %>%
#   t_test_analyses(.)
# > NOT ENOUGH OBSERVATIONS

results_exp_8nri_h2_demand_compliance_excluded <- data_exp_8nri %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8nri_h2_reactance_self_reports_excluded <- data_exp_8nri %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


## exp 8 random instructions
results_exp_8ri_h2_us_contingency_memory_excluded <- data_exp_8ri %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8ri_h2_demand_compliance_excluded <- data_exp_8ri %>%
  filter(demand_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)

results_exp_8ri_h2_reactance_self_reports_excluded <- data_exp_8ri %>%
  filter(reactance_self_reports == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = source_valence_condition) %>%
  t_test_analyses(.)


# US contingency_memory
results_for_meta_analysis_h2_us_contingency_memory_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", 
                            "Experiment 7",
                            #"Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]],
                          results_exp_7_h2_us_contingency_memory$cohens_d$estimate[[1]],
                          #results_exp_8nri_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_8ri_h2_us_contingency_memory_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        #results_exp_8nri_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2_us_contingency_memory_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        #results_exp_8nri_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2_us_contingency_memory_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# color valence contingency_memory
results_for_meta_analysis_h2_color_valence_contingency_memory_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", 
                            "Experiment 7"), 
             cohens_d = c(results_exp_1_h2_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h2_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h2_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h2_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h2_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]],
                          results_exp_7_h2_color_valence_contingency_memory_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_color_valence_contingency_memory_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# demand_compliance
results_for_meta_analysis_h2_demand_compliance_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 7",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h2_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h2_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h2_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h2_demand_compliance_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h2_demand_compliance_excluded$cohens_d$estimate[[1]],
                          results_exp_6_h2_demand_compliance_excluded$cohens_d$estimate[[1]],
                          results_exp_7_h2_demand_compliance_excluded$cohens_d$estimate[[1]],
                          results_exp_8nri_h2_demand_compliance_excluded$cohens_d$estimate[[1]], 
                          results_exp_8ri_h2_demand_compliance_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_6_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2_demand_compliance_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_6_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2_demand_compliance_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# reactance_self_reports
results_for_meta_analysis_h2_reactance_self_reports_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", 
                            "Experiment 4", "Experiment 5", "Experiment 6",
                            "Experiment 7",
                            "Experiment 8 (standard)", 
                            "Experiment 8 (random)"), 
             cohens_d = c(results_exp_1_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]], 
                          results_exp_2_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]], 
                          results_exp_3_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]], 
                          results_exp_4_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]],
                          results_exp_5_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]],
                          results_exp_6_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]],
                          results_exp_7_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]],
                          results_exp_8nri_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]], 
                          results_exp_8ri_h2_reactance_self_reports_excluded$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_2_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_3_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_4_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_5_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_6_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_7_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8nri_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]],
                        results_exp_8ri_h2_reactance_self_reports_excluded$cohens_d$conf.int[["lower"]]),
             ci_upr = c(results_exp_1_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_2_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_3_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_4_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_5_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_6_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_7_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8nri_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]],
                        results_exp_8ri_h2_reactance_self_reports_excluded$cohens_d$conf.int[["upper"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# fit metas
mod_meta_results_h2_us_contingency_memory <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h2_us_contingency_memory, exclude = FALSE),
                                                              results_for_meta_analysis_h2_us_contingency_memory_excluded,
                                                              by = "Experiment"), 
                                                    results_for_meta_analysis_h2_us_contingency_memory_excluded),
                                   effect_size_label = "Cohen's d")

mod_meta_results_h2_color_valence_contingency_memory <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h2_color_valence_contingency_memory, exclude = FALSE),
                                                              results_for_meta_analysis_h2_color_valence_contingency_memory_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h2_color_valence_contingency_memory_excluded),
                                   effect_size_label = "Cohen's d")

mod_meta_results_h2_demand_compliance <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h2_demand_compliance, exclude = FALSE),
                                                              results_for_meta_analysis_h2_demand_compliance_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h2_demand_compliance_excluded), 
                                   effect_size_label = "Cohen's d")

mod_meta_results_h2_reactance_self_reports <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h2_reactance_self_reports, exclude = FALSE),
                                                              results_for_meta_analysis_h2_reactance_self_reports_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h2_reactance_self_reports_excluded), 
                                   effect_size_label = "Cohen's d")

# forest plots
forest(mod_meta_results_h2_us_contingency_memory$fitted_model)
forest(mod_meta_results_h2_color_valence_contingency_memory$fitted_model)
forest(mod_meta_results_h2_demand_compliance$fitted_model)
forest(mod_meta_results_h2_reactance_self_reports$fitted_model)

```

Moderation by:

- US contingency memory (TRUE were excluded): `r mod_meta_results_h2_us_contingency_memory$mod_meta_analysis_results_text`
- color-valence contingency memory (TRUE were excluded): `r mod_meta_results_h2_color_valence_contingency_memory$mod_meta_analysis_results_text`
- demand compliance (FALSE were excluded): `r mod_meta_results_h2_demand_compliance$mod_meta_analysis_results_text`
- reactance (FALSE were excluded): `r mod_meta_results_h2_reactance_self_reports$mod_meta_analysis_results_text`

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
# exp 1
results_exp_1_h3_us_contingency_memory_excluded <- data_exp_1 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_1_h3_color_valence_contingency_memory_excluded <- data_exp_1 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 2
results_exp_2_h3_us_contingency_memory_excluded <- data_exp_2 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_2_h3_color_valence_contingency_memory_excluded <- data_exp_2 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 3
results_exp_3_h3_us_contingency_memory_excluded <- data_exp_3 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_3_h3_color_valence_contingency_memory_excluded <- data_exp_3 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 4
results_exp_4_h3_us_contingency_memory_excluded <- data_exp_4 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_4_h3_color_valence_contingency_memory_excluded <- data_exp_4 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 5
results_exp_5_h3_us_contingency_memory_excluded <- data_exp_5 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_5_h3_color_valence_contingency_memory_excluded <- data_exp_5 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# exp 7
results_exp_7_h3_us_contingency_memory_excluded <- data_exp_7 %>%
  filter(US_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

results_exp_7_h3_color_valence_contingency_memory_excluded <- data_exp_7 %>%
  filter(color_valence_contingency_memory == FALSE) %>%
  mutate(DV = intention,
         IV = source_valence_condition) %>%
  multinominal_analysis()

# us contingency memory
results_for_meta_analysis_h3_us_contingency_memory_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", 
                            "Experiment 5", "Experiment 7"),
             logOR = c(results_exp_1_h3_us_contingency_memory_excluded$logOR[results_exp_1_h3_us_contingency_memory_excluded$var == "Struan"], 
                       results_exp_2_h3_us_contingency_memory_excluded$logOR[results_exp_2_h3_us_contingency_memory_excluded$var == "Struan"],
                       results_exp_3_h3_us_contingency_memory_excluded$logOR[results_exp_3_h3_us_contingency_memory_excluded$var == "Struan"],
                       results_exp_4_h3_us_contingency_memory_excluded$logOR[results_exp_4_h3_us_contingency_memory_excluded$var == "Struan"],
                       results_exp_5_h3_us_contingency_memory_excluded$logOR[results_exp_5_h3_us_contingency_memory_excluded$var == "Struan"],
                       results_exp_7_h3_us_contingency_memory_excluded$logOR[results_exp_7_h3_us_contingency_memory_excluded$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_us_contingency_memory_excluded$logOR_se[results_exp_1_h3_us_contingency_memory_excluded$var == "Struan"],
                          results_exp_2_h3_us_contingency_memory_excluded$logOR_se[results_exp_2_h3_us_contingency_memory_excluded$var == "Struan"],
                          results_exp_3_h3_us_contingency_memory_excluded$logOR_se[results_exp_3_h3_us_contingency_memory_excluded$var == "Struan"],
                          results_exp_4_h3_us_contingency_memory_excluded$logOR_se[results_exp_4_h3_us_contingency_memory_excluded$var == "Struan"],
                          results_exp_5_h3_us_contingency_memory_excluded$logOR_se[results_exp_5_h3_us_contingency_memory_excluded$var == "Struan"],
                          results_exp_7_h3_us_contingency_memory_excluded$logOR_se[results_exp_7_h3_us_contingency_memory_excluded$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# color valence contingency memory
results_for_meta_analysis_h3_color_valence_contingency_memory_excluded <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", 
                            "Experiment 5", "Experiment 7"),
             logOR = c(results_exp_1_h3_color_valence_contingency_memory_excluded$logOR[results_exp_1_h3_color_valence_contingency_memory_excluded$var == "Struan"], 
                       results_exp_2_h3_color_valence_contingency_memory_excluded$logOR[results_exp_2_h3_color_valence_contingency_memory_excluded$var == "Struan"],
                       results_exp_3_h3_color_valence_contingency_memory_excluded$logOR[results_exp_3_h3_color_valence_contingency_memory_excluded$var == "Struan"],
                       results_exp_4_h3_color_valence_contingency_memory_excluded$logOR[results_exp_4_h3_color_valence_contingency_memory_excluded$var == "Struan"],
                       results_exp_5_h3_color_valence_contingency_memory_excluded$logOR[results_exp_5_h3_color_valence_contingency_memory_excluded$var == "Struan"],
                       results_exp_7_h3_color_valence_contingency_memory_excluded$logOR[results_exp_7_h3_color_valence_contingency_memory_excluded$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_color_valence_contingency_memory_excluded$logOR_se[results_exp_1_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_2_h3_color_valence_contingency_memory_excluded$logOR_se[results_exp_2_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_3_h3_color_valence_contingency_memory_excluded$logOR_se[results_exp_3_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_4_h3_color_valence_contingency_memory_excluded$logOR_se[results_exp_4_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_5_h3_color_valence_contingency_memory_excluded$logOR_se[results_exp_5_h3_color_valence_contingency_memory$var == "Struan"],
                          results_exp_7_h3_color_valence_contingency_memory_excluded$logOR_se[results_exp_7_h3_color_valence_contingency_memory$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2") %>%
  mutate(exclude = TRUE)

# meta fits
mod_meta_results_h3_us_contingency_memory <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h3_us_contingency_memory, exclude = FALSE),
                                                              results_for_meta_analysis_h3_us_contingency_memory_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h3_us_contingency_memory_excluded),
                                   effect_size_label = "Odds Ratio")

mod_meta_results_h3_color_valence_contingency_memory <- 
  moderator_meta_analysis_workflow(data = bind_rows(semi_join(mutate(results_for_meta_analysis_h3_color_valence_contingency_memory, exclude = FALSE),
                                                              results_for_meta_analysis_h3_color_valence_contingency_memory_excluded,
                                                              by = "Experiment"),
                                                    results_for_meta_analysis_h3_color_valence_contingency_memory_excluded),
                                   effect_size_label = "Odds Ratio")

# forest plots
forest(mod_meta_results_h3_us_contingency_memory$fitted_model)
forest(mod_meta_results_h3_color_valence_contingency_memory$fitted_model)

```

Moderation by:

- US contingency memory (TRUE were excluded): `r mod_meta_results_h3_us_contingency_memory$mod_meta_analysis_results_text`
- color-valence contingency memory (TRUE were excluded): `r mod_meta_results_h3_color_valence_contingency_memory$mod_meta_analysis_results_text`

