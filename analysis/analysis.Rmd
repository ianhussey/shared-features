---
title: "Analyses of learning via shared features experiments"
author: "Ian Hussey"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    number_sections: no
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)
```

```{r}

# disable scientific notation
options(scipen = 999) 

# dependencies
library(tidyverse)
library(effsize)
library(foreign)
library(timesavers)
library(BayesFactor)
library(weights)
library(sjPlot)
library(nnet)
library(metafor)

```

# Data processing

```{r}

# get data

# convert SPSS to csv
input_data_exp_1 <- 
  read.spss("../experiment 1/data/processed/Shared_Features_Study_1_FINAL.sav", to.data.frame = TRUE)

input_data_exp_2 <- 
  read.spss("../experiment 2/data/processed/Shared_Features_Study_2_FINAL.sav", to.data.frame = TRUE)

input_data_exp_3 <- 
  read.spss("../experiment 3/data/processed/Shared_Features_Study_3_FINAL.sav", to.data.frame = TRUE)

input_data_exp_4 <- 
  read.spss("../experiment 4/data/processed/Shared_Features_Study_4_FINAL.sav", to.data.frame = TRUE)

input_data_exp_5 <- 
  read.spss("../experiment 5/data/processed/Shared_Features_Study_5_FINAL.sav", to.data.frame = TRUE)

write_csv(input_data_exp_1, "../experiment 1/data/processed/data_processed.csv")
write_csv(input_data_exp_2, "../experiment 2/data/processed/data_processed.csv")
write_csv(input_data_exp_3, "../experiment 3/data/processed/data_processed.csv")
write_csv(input_data_exp_4, "../experiment 4/data/processed/data_processed.csv")
write_csv(input_data_exp_5, "../experiment 5/data/processed/data_processed.csv")

# tidy data
tidied_data_exp_1 <- read.csv("../experiment 1/data/processed/data_processed.csv") %>%
  mutate(intention = str_remove_all(Intentions_response, " "),
         intention = str_remove_all(intention, "Iwouldtry"),
         intention = as.factor(intention),
         contingency_memory = ifelse(Total_Contingency_Awareness_Score == 2, TRUE, FALSE),
         hypothesis_awareness = ifelse(Hypothesis_Awareness_recoded == "Correct", TRUE, FALSE),
         influence_awareness = ifelse(Influence_Awareness_recoded == 1, TRUE, FALSE),
         demand_IAT = ifelse(Demand_IAT == "Yes", TRUE, FALSE), 
         demand_self_reports = ifelse(Demand_Self_Reports == "Yes", TRUE, FALSE)) %>%
  select(Participant, 
         Color_Matching,
         IAT_Score,
         EC_Effect_CS1_CS2_Difference_Score,
         intention,
         contingency_memory,
         hypothesis_awareness,
         influence_awareness,
         demand_IAT,
         demand_self_reports) %>%
  mutate(Color_Matching = as.factor(str_replace_all(as.character(Color_Matching), " ", "")))

tidied_data_exp_2 <- read.csv("../experiment 2/data/processed/data_processed.csv") %>%
  mutate(intention = str_remove_all(Intentions_response, " "),
         intention = str_remove_all(intention, "Iwouldtry"),
         intention = as.factor(intention),
         contingency_memory = ifelse(Total_Contingency_Awareness_Score == 2, TRUE, FALSE),
         hypothesis_awareness = ifelse(Hypothesis_Awareness_recoded == "Correct", TRUE, FALSE),
         influence_awareness = ifelse(Influence_Awareness_recoded == 1, TRUE, FALSE),
         demand_IAT = ifelse(Demand_IAT == "Yes", TRUE, FALSE), 
         demand_self_reports = ifelse(Demand_Self_Reports == "Yes", TRUE, FALSE)) %>%
  select(Participant, 
         Color_Matching,
         IAT_Score,
         EC_Effect_CS1_CS2_Difference_Score,
         intention,
         contingency_memory,
         hypothesis_awareness,
         influence_awareness,
         demand_IAT,
         demand_self_reports) %>%
  mutate(Color_Matching = as.factor(str_replace_all(as.character(Color_Matching), " ", "")))

tidied_data_exp_3 <- read.csv("../experiment 3/data/processed/data_processed.csv") %>%
  mutate(intention = str_remove_all(Intentions_response, " "),
         intention = str_remove_all(intention, "Iwouldtry"),
         intention = as.factor(intention),
         contingency_memory = ifelse(Total_Contingency_Awareness_Score == 2, TRUE, FALSE),
         hypothesis_awareness = ifelse(Hypothesis_Awareness_recoded == "Correct", TRUE, FALSE),
         influence_awareness = ifelse(Influence_Awareness_recoded == 1, TRUE, FALSE),
         demand_IAT = ifelse(Demand_IAT == "Yes", TRUE, FALSE), 
         demand_self_reports = ifelse(Demand_Self_Reports == "Yes", TRUE, FALSE)) %>%
  select(Participant, 
         Color_Matching,
         IAT_Score,
         EC_Effect_CS1_CS2_Difference_Score,
         intention,
         contingency_memory,
         hypothesis_awareness,
         influence_awareness,
         demand_IAT,
         demand_self_reports) %>%
  mutate(Color_Matching = as.factor(str_replace_all(as.character(Color_Matching), " ", "")))

tidied_data_exp_4 <- read.csv("../experiment 4/data/processed/data_processed.csv") %>%
  mutate(intention = str_remove_all(Intentions_response, " "),
         intention = str_remove_all(intention, "Iwouldtry"),
         intention = as.factor(intention),
         contingency_memory = ifelse(Total_Contingency_Awareness_Score == 2, TRUE, FALSE),
         hypothesis_awareness = ifelse(Hypothesis_Awareness_recoded == "Correct", TRUE, FALSE),
         influence_awareness = ifelse(Influence_Awareness_recoded == 1, TRUE, FALSE),
         demand_IAT = ifelse(Demand_IAT == "Yes", TRUE, FALSE), 
         demand_self_reports = ifelse(Demand_Self_Reports == "Yes", TRUE, FALSE)) %>%
  select(Participant, 
         Color_Matching,
         IAT_Score,
         EC_Effect_CS1_CS2_Difference_Score,
         intention,
         contingency_memory,
         hypothesis_awareness,
         influence_awareness,
         demand_IAT,
         demand_self_reports) %>%
  mutate(Color_Matching = as.factor(str_replace_all(as.character(Color_Matching), " ", "")))

tidied_data_exp_5 <- read.csv("../experiment 5/data/processed/data_processed.csv") %>%
  mutate(intention = str_remove_all(Intentions_response, " "),
         intention = str_remove_all(intention, "Iwouldtry"),
         intention = as.factor(intention),
         contingency_memory = ifelse(Total_Contingency_Awareness_Score == 2, TRUE, FALSE),
         hypothesis_awareness = ifelse(Hypothesis_Awareness_recoded == "Correct", TRUE, FALSE),
         influence_awareness = ifelse(Influence_Awareness_recoded == 1, TRUE, FALSE),
         demand_IAT = ifelse(Demand_IAT == "Yes", TRUE, FALSE), 
         demand_self_reports = ifelse(Demand_Self_Reports == "Yes", TRUE, FALSE)) %>%
  select(Participant, 
         Color_Matching,
         IAT_Score,
         EC_Effect_CS1_CS2_Difference_Score,
         intention,
         contingency_memory,
         hypothesis_awareness,
         influence_awareness,
         demand_IAT,
         demand_self_reports) %>%
  mutate(Color_Matching = as.factor(str_replace_all(as.character(Color_Matching), " ", "")))

# write to disk
write_csv(tidied_data_exp_1, "../experiment 1/data/processed/data_for_analysis.csv")
write_csv(tidied_data_exp_2, "../experiment 2/data/processed/data_for_analysis.csv")
write_csv(tidied_data_exp_3, "../experiment 3/data/processed/data_for_analysis.csv")
write_csv(tidied_data_exp_4, "../experiment 4/data/processed/data_for_analysis.csv")
write_csv(tidied_data_exp_5, "../experiment 5/data/processed/data_for_analysis.csv")

```

# Analytic strategy

```{r}

# analysis workflow. is applied witin all studies ---------------

# between groups comparisons analysis workflow ------
t_test_analyses <- function(data) {
  
  # summary stats
  summary_stats <- data %>%
    group_by(IV) %>%
    dplyr::summarize(mean = mean(DV),
                     sd = sd(DV)) %>%
    round_df(2)
  
  # t test
  t_test <- t.test(formula = DV ~ IV,
                   alternative = "two.sided",
                   paired = FALSE,
                   data = data)
  
  # effect size
  # formula based cohen's d seems to be invariant to ordering of the levels, can't control whether the direction 
  # cohens_d <- effsize::cohen.d(formula = DV ~ IV,
  #                              paired = FALSE,
  #                              data = data)
  cohens_d <- effsize::cohen.d(data$DV[data$IV == "CS1_Positive_CS2_Negative"],
                               data$DV[data$IV == "CS2_Positive_CS1_Negative"],
                               paired = FALSE)
  
  # printing
  t_test_p <- t_test$p.value[[1]]
  t_test_p_apa <- ifelse(t_test_p < 0.001, "< .001", 
                         ifelse(t_test_p < 0.01,
                                paste("= ", rd(t_test_p, 3), sep = ""),  # rd() rounds, converts to string, and removes the leading 0.
                                paste("= ", rd(t_test_p, 2), sep = "")))
  
  t_test_output <- paste("t(", format(round(t_test$parameter[[1]], 2), nsmall = 2), 
                         ") = ", format(round(t_test$statistic[[1]], 2), nsmall = 2), 
                         ", p ", t_test_p_apa, 
                         ", d = ", format(round(cohens_d$estimate[[1]], 2), nsmall = 2), 
                         ", 95% CI = [", format(round(cohens_d$conf.int[["inf"]], 2), nsmall = 2), ", ", 
                         format(round(cohens_d$conf.int[["sup"]], 2), nsmall = 2), "]", 
                         sep = "")
  
  # bayes factor t test
  t_test_bf <- ttestBF(formula = DV ~ IV,
                       data = data)
  
  bf10 <- round(exp(t_test_bf@bayesFactor$bf), 2)
  
  return(list(summary_stats = summary_stats,
              t_test = t_test,
              cohens_d = cohens_d,
              t_test_output = t_test_output,
              t_test_p = t_test_p,
              t_test_bf = t_test_bf,
              bf10 = bf10))
}

# multinominal analysis workflow ------
multinominal_analysis <- function(data) {
  
  # fit model
  fit <- multinom(intention ~ Color_Matching, 
                  data = data)
  
  # calculate p values
  z <- summary(fit)$coefficients/summary(fit)$standard.errors
  p <- (1 - pnorm(abs(z), 0, 1)) * 2
  
  pvalues <- p %>%
    as.data.frame() %>%
    rownames_to_column(var = "var") %>%
    
    # no idea why this var name contains so many spaces, but it does, so go figure
    rename(p = "Color_MatchingCS2_Positive_CS1_Negative") %>%
    mutate(p = apa_p_value(p)) %>%
    select(p)
  
  # calc odds ratios and CIs
  coefficients <- as.data.frame(summary(fit)$coefficients) %>%
    rownames_to_column(var = "var") %>%
    rename(logOR_Color_Matching = "Color_MatchingCS2_Positive_CS1_Negative") %>%
    select(var, logOR_Color_Matching)
  
  se <- as.data.frame(summary(fit)$standard.errors) %>%
    rownames_to_column(var = "var") %>%
    rename(logOR_se_Color_Matching = "Color_MatchingCS2_Positive_CS1_Negative") %>%
    select(logOR_se_Color_Matching)
  
  # combine
  results <- cbind(coefficients, se) %>%
    mutate(OR = round(exp(logOR_Color_Matching), 2),
           OR_ci_lwr = round(exp(logOR_Color_Matching - logOR_se_Color_Matching*1.96), 2),
           OR_ci_upr = round(exp(logOR_Color_Matching + logOR_se_Color_Matching*1.96), 2)) %>%
    cbind(pvalues) %>%
    rename(logOR = logOR_Color_Matching,
           logOR_se = logOR_se_Color_Matching)
  
  return(results)
}

# meta analysis workflow ------
meta_analysis_workflow <- function(data, 
                                   effect_size_label, 
                                   reference_line, 
                                   exp_estimates = FALSE,
                                   plot = TRUE) {
  require(timesavers)
  require(tidyverse)
  require(metafor)
  
  # fit random effects model 
  fitted_model <- 
    rma(yi = yi, 
        sei = sei,
        data = data,
        slab = Experiment)
  
  p_value <- apa_p_value(fitted_model$pval)
  
  # model predictions
  meta_analysis_results <-
    predict(fitted_model, digits = 5) %>%
    as.data.frame() %>%
    gather() %>%
    round_df(2) %>%
    dplyr::rename(metric = key,
                  estimate = value) %>%
    mutate(metric = dplyr::recode(metric,
                                  "pred" = paste0("Meta analysed ", effect_size_label),
                                  "ci.lb" = "95% CI lower",
                                  "ci.ub" = "95% CI upper",
                                  "cr.lb" = "95% CR lower",
                                  "cr.ub" = "95% CR upper"))
  
  # Color_Matchingally exponentiate estimates if converting log odds to odds ratios
  if(exp_estimates == TRUE) {
    meta_analysis_results <- meta_analysis_results %>%
      mutate(estimate = round(exp(estimate), 2))
  }
  
  meta_analysis_results <- rbind(meta_analysis_results,
                                 data.frame(metric = "p",
                                            estimate = p_value))
  
  # summarize results
  meta_analysis_results_text <- 
    paste0("k = ", fitted_model$k, ", ", 
           effect_size_label, " = ", meta_analysis_results$estimate[1],
           # dynamic indexing of some values as different models return variables in different locations, but relative location is reliable
           ", 95% CI = [", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-4],  
           ", ", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-3], 
           "], 95% CR = [", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-2], 
           ", ", meta_analysis_results$estimate[length(meta_analysis_results$estimate)-1],
           "], p ", meta_analysis_results$estimate[length(meta_analysis_results$estimate)])
  
  heterogeneity_test_results_text <- 
    paste0("Q(df = ",    fitted_model$k - 1, ") = ", round(fitted_model$QE, 2), 
           ", p = ",     ifelse(fitted_model$pval < 0.001, "< .001", as.character(round(fitted_model$pval, 3))),
           ", tau^2 = ", round(fitted_model$tau2, 2), 
           ", I^2 = ",   round(fitted_model$I2, 2),
           ", H^2 = ",   round(fitted_model$H2, 2))
  
  # forest plot
  if (exp_estimates == TRUE) {
    transformation <- exp
  } else { 
    transformation <- NULL
  }
  
  
  if (plot == TRUE) {
    forest_plot <- forest(fitted_model,
                          xlab = effect_size_label,
                          addcred = TRUE,
                          atransf = transformation,
                          refline = reference_line)
  } else {
    forest_plot <- NULL
  }
  
  
  return(list(fitted_model = fitted_model, 
              meta_analysis_results = meta_analysis_results,
              meta_analysis_results_text = meta_analysis_results_text,
              heterogeneity_test_results_text = heterogeneity_test_results_text,
              forest_plot = forest_plot))
}


# robustness between original test and subset -----------
robust_test <- function(subset_test, original_test) {
  
  subset_p <- subset_test$estimate[subset_test$metric == "p"] %>%
    str_remove(., "=") %>%
    str_remove(., "<") %>%
    str_remove(., " ") %>%
    as.numeric()
  
  original_p <- original_test$estimate[original_test$metric == "p"] %>%
    str_remove(., "=") %>%
    str_remove(., "<") %>%
    str_remove(., " ") %>%
    as.numeric()
  
  return((subset_p >= 0.05 & original_p >= 0.05) | (subset_p < 0.05 & original_p < 0.05))
}

```

# Experiments 

## Experiment 1

### H1: IAT

```{r}

results_exp_1_h1 <- tidied_data_exp_1 %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_1_h1$summary_stats$mean[results_exp_1_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h1$summary_stats$sd[results_exp_1_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_1_h1$summary_stats$mean[results_exp_1_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h1$summary_stats$sd[results_exp_1_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_1_h1$t_test_output`, BF10 = `r format(results_exp_1_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_1_h2 <- tidied_data_exp_1 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_1_h2$summary_stats$mean[results_exp_1_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h2$summary_stats$sd[results_exp_1_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_1_h2$summary_stats$mean[results_exp_1_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_1_h2$summary_stats$sd[results_exp_1_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_1_h2$t_test_output`, BF10 = `r format(results_exp_1_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
tidied_data_exp_1$intention <- relevel(tidied_data_exp_1$intention, ref = "Morag")

results_exp_1_h3 <- multinominal_analysis(tidied_data_exp_1)

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_1_h3$OR[results_exp_1_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_1_h3$OR_ci_lwr[results_exp_1_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_1_h3$OR_ci_upr[results_exp_1_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_1_h3$p[results_exp_1_h3$var == "Struan"]`.

## Experiment 2

### H1: IAT

```{r}

results_exp_2_h1 <- tidied_data_exp_2 %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS2 eventually shared a color with positive words and CS1 shared a color with negative words, participants showed an automatic relative preference for CS2 over CS1 on the IAT (M = `r format(results_exp_2_h1$summary_stats$mean[results_exp_2_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h1$summary_stats$sd[results_exp_2_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`). whereas when CS2 eventually shared a color with negative words and CS1 shared a color with positive words, they demonstrated a relative preference for CS1 over CS2 (M = `r format(results_exp_2_h1$summary_stats$mean[results_exp_2_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h1$summary_stats$sd[results_exp_2_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_2_h1$t_test_output`, BF10 = `r format(results_exp_2_h1$bf10, nsmall = 2)`.

Note that this result is in the opposite direction to all other experiments.

### H2: Self-report ratings

```{r}

results_exp_2_h2 <- tidied_data_exp_2 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

Regardless of whether CS1 eventually shared a color with positive or negative words, participants showed a relative preference on the self-report ratings for CS2 over CS1 (CS1-positive condition: M = `r format(results_exp_2_h2$summary_stats$mean[results_exp_2_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h2$summary_stats$sd[results_exp_2_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`; CS1-negative condition: M = `r format(results_exp_2_h2$summary_stats$mean[results_exp_2_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_2_h2$summary_stats$sd[results_exp_2_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_2_h2$t_test_output`, BF10 = `r format(results_exp_2_h2$bf10, nsmall = 2)`.

Note that this null result is different to all other experiments.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
tidied_data_exp_2$intention <- relevel(tidied_data_exp_2$intention, ref = "Morag")

results_exp_2_h3 <- multinominal_analysis(tidied_data_exp_2)

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, but in the opposite direction to that predicted, OR = `r format(results_exp_2_h3$OR[results_exp_2_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_2_h3$OR_ci_lwr[results_exp_2_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_2_h3$OR_ci_upr[results_exp_2_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_2_h3$p[results_exp_2_h3$var == "Struan"]`.

Note that this result is in the opposite direction to all other experiments.

## Experiment 3

### H1: IAT

```{r}

results_exp_3_h1 <- tidied_data_exp_3 %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_3_h1$summary_stats$mean[results_exp_3_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h1$summary_stats$sd[results_exp_3_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_3_h1$summary_stats$mean[results_exp_3_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h1$summary_stats$sd[results_exp_3_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_3_h1$t_test_output`, BF10 = `r format(results_exp_3_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_3_h2 <- tidied_data_exp_3 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_3_h2$summary_stats$mean[results_exp_3_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h2$summary_stats$sd[results_exp_3_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_3_h2$summary_stats$mean[results_exp_3_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_3_h2$summary_stats$sd[results_exp_3_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_3_h2$t_test_output`, BF10 = `r format(results_exp_3_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
tidied_data_exp_3$intention <- relevel(tidied_data_exp_3$intention, ref = "Morag")

results_exp_3_h3 <- multinominal_analysis(tidied_data_exp_3)

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_3_h3$OR[results_exp_3_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_3_h3$OR_ci_lwr[results_exp_3_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_3_h3$OR_ci_upr[results_exp_3_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_3_h3$p[results_exp_3_h3$var == "Struan"]`.

## Experiment 4

### H1: IAT

```{r}

results_exp_4_h1 <- tidied_data_exp_4 %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_4_h1$summary_stats$mean[results_exp_4_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h1$summary_stats$sd[results_exp_4_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_4_h1$summary_stats$mean[results_exp_4_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h1$summary_stats$sd[results_exp_4_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_4_h1$t_test_output`, BF10 = `r format(results_exp_4_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_4_h2 <- tidied_data_exp_4 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_4_h2$summary_stats$mean[results_exp_4_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h2$summary_stats$sd[results_exp_4_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_4_h2$summary_stats$mean[results_exp_4_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_4_h2$summary_stats$sd[results_exp_4_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_4_h2$t_test_output`, BF10 = `r format(results_exp_4_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
tidied_data_exp_4$intention <- relevel(tidied_data_exp_4$intention, ref = "Morag")

results_exp_4_h3 <- multinominal_analysis(tidied_data_exp_4)

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_4_h3$OR[results_exp_4_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_4_h3$OR_ci_lwr[results_exp_4_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_4_h3$OR_ci_upr[results_exp_4_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_4_h3$p[results_exp_4_h3$var == "Struan"]`.

## Experiment 5

### H1: IAT

```{r}

results_exp_5_h1 <- tidied_data_exp_5 %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed an automatic relative preference for CS1 over CS2 on the IAT (M = `r format(results_exp_5_h1$summary_stats$mean[results_exp_5_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h1$summary_stats$sd[results_exp_5_h1$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_5_h1$summary_stats$mean[results_exp_5_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h1$summary_stats$sd[results_exp_5_h1$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_5_h1$t_test_output`, BF10 = `r format(results_exp_5_h1$bf10, nsmall = 2)`.

### H2: Self-report ratings

```{r}

results_exp_5_h2 <- tidied_data_exp_5 %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

```

When CS1 eventually shared a color with positive words and CS2 shared a color with negative words, participants showed a relative preference on the self-report ratings for CS1 over CS2 (M = `r format(results_exp_5_h2$summary_stats$mean[results_exp_5_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h2$summary_stats$sd[results_exp_5_h2$summary_stats$IV == "CS1_Positive_CS2_Negative"], nsmall = 2)`), whereas when CS1 eventually shared a color with negative words and CS2 shared a color with positive words, they demonstrated a relative preference for CS2 over CS1 (M = `r format(results_exp_5_h2$summary_stats$mean[results_exp_5_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`, SD = `r format(results_exp_5_h2$summary_stats$sd[results_exp_5_h2$summary_stats$IV == "CS2_Positive_CS1_Negative"], nsmall = 2)`), `r results_exp_5_h2$t_test_output`, BF10 = `r format(results_exp_5_h2$bf10, nsmall = 2)`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# set reference level to "Morag"
tidied_data_exp_5$intention <- relevel(tidied_data_exp_5$intention, ref = "Morag")

results_exp_5_h3 <- multinominal_analysis(tidied_data_exp_5)

```

Data from the behavioural intentions question were entered into a multinomial logistic regression with CSI as the reference category. Only results from the CS1-CS2 comparison are relevant to the hypothesis and will be reported here. Results demonstrated that participants responses of CS1 relative to CS2 differed between the two conditions, congruent with training, OR = `r format(results_exp_5_h3$OR[results_exp_5_h3$var == "Struan"], nsmall = 2)`, 95% CI = [`r format(results_exp_5_h3$OR_ci_lwr[results_exp_5_h3$var == "Struan"], nsmall = 2)`, `r format(results_exp_5_h3$OR_ci_upr[results_exp_5_h3$var == "Struan"], nsmall = 2)`], p `r results_exp_5_h3$p[results_exp_5_h3$var == "Struan"]`.

# Meta analyses

Random effects meta analyses were fitted using the metafor R package (Viechtbauer, 2010). The maximum liklihood estimator was used.  

A separate meta analysis was fitted for each outcome variable (IAT, self reported ratings, behavioural intentions). Although multivariate meta analysis was a possible alternative, previous work has traditionally assessed these dependant variables separately. 

## Meta analysed effect size

Notes on meta analysed effect size:

Credibility intervals refer to the interval of effect sizes likely to be observed in a future study on the basis of the width of estimation of the true effect size combined with variation in this true effect size (e.g., due to heterogeneity). 

Notes on heterogeneity metrics:

- Q and its p value: A measure of weighted squared deviations. Depends on number of studies.
- tau^2: Population between-studies variance, ie estimated amount of total true heterogeneity in the effect. Is on the same scale as the meta analysed effect size, and so cannot be compared between meta analysis using different scales (e.g., Cohen's d vs. Odds Ratios).
- I^2: Percentage of variation in the observed effects that is due to true heterogeneity (as quantified by tau^2) as opposed to sampling variation. Metric is therefore a description of data in sample, not an underlying quality associated with the true effect. Can be thought of as analogous to the reliability of a scale, which also represents the percentage of true variance as portion of total variance. Range 0-100, lower values preferable. E.g., 0 = no variability in observed effects to be explained as a systematic influence (e.g., some due to some moderator) as its all just sampling variation. Does not depend on the effect size scale or the number of studies.
- H^2: Total variability / sampling variability, i.e., (true variability / sampling variability)/sampling variability. Lower values preferable, i.e., refer to less true variation to be explained as systematic (e.g., due to some moderator).

### H1: IAT

```{r}

results_for_meta_analysis_h1 <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h1$cohens_d$estimate[[1]], 
                          results_exp_2_h1$cohens_d$estimate[[1]], 
                          results_exp_3_h1$cohens_d$estimate[[1]], 
                          results_exp_4_h1$cohens_d$estimate[[1]],
                          results_exp_5_h1$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1$cohens_d$conf.int[["inf"]],
                        results_exp_2_h1$cohens_d$conf.int[["inf"]],
                        results_exp_3_h1$cohens_d$conf.int[["inf"]],
                        results_exp_4_h1$cohens_d$conf.int[["inf"]],
                        results_exp_5_h1$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h1$cohens_d$conf.int[["sup"]],
                        results_exp_2_h1$cohens_d$conf.int[["sup"]],
                        results_exp_3_h1$cohens_d$conf.int[["sup"]],
                        results_exp_4_h1$cohens_d$conf.int[["sup"]],
                        results_exp_5_h1$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2))

meta_results_h1 <- meta_analysis_workflow(data              = results_for_meta_analysis_h1,
                                          effect_size_label = "Cohen's d",
                                          exp_estimates     = FALSE,
                                          reference_line    = 0)

```

- Results demonstrated a significant effect of medium size (Cohen, 1988): `r meta_results_h1$meta_analysis_results_text`
- Results were found to contain a high degree of heterogeneity: `r meta_results_h1$heterogeneity_test_results_text`

#### Outlier tests

Undue [influence](https://rdrr.io/cran/metafor/man/influence.rma.uni.html) of one or more studies on either the meta analysed effect size or the heterogeneity among studies was then assessed.

Note on influence metrics from the metafor package documentation:

- The DFFITS value indicates how many standard deviations the predicted (average) effect for the ith study changes after excluding the ith study from the model fitting.
- The leave-one-out amount of (residual) heterogeneity is the estimated value of Ï„<c2><b2> based on the dataset with the ith study removed. Note that this is always equal to 0 for fixed-effects models.
- Similarly, the leave-one-out test statistic for the test of (residual) heterogeneity is the value of the test statistic of the test for (residual) heterogeneity calculated based on the dataset with the ith study removed.

Outliers were assessed on the baiss of undue influence, on the predicted average effect size/coefficients (DFFITS), and the large decrease in heterogeneity on the basis of its removal (tau2.del, QE.del). Note that outliers were also selected based on consistency across all three DVs (see other analyses below).

```{r fig.height=8, fig.width=4}

influence_meta_results_h1 <- influence(meta_results_h1$fitted_model)

print(influence_meta_results_h1, digits = 2) 

```

Experiment 2 was assessed as being an outlier. 

####  Sensitivity analysis

A sensitivity analysis therefore excluded Experiment 2 and re meta analysed. 

```{r}

results_for_meta_analysis_h1_sensitivity <- results_for_meta_analysis_h1 %>%
  filter(Experiment != "Experiment 2")

# save for vector plotting later
write_csv(results_for_meta_analysis_h1_sensitivity, "../plots/results_for_meta_analysis_h1_sensitivity.csv")

meta_results_h1_sensitivity <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_sensitivity,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0)

```

- After excluding one experiment as an outlier, the meta analysed effect size was found to be of large size: `r meta_results_h1_sensitivity$meta_analysis_results_text`, and heterogeneity was found to lower, `r meta_results_h1_sensitivity$heterogeneity_test_results_text`.

### H2: Self-report ratings

```{r}

results_for_meta_analysis_h2 <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h2$cohens_d$estimate[[1]], 
                          results_exp_2_h2$cohens_d$estimate[[1]], 
                          results_exp_3_h2$cohens_d$estimate[[1]], 
                          results_exp_4_h2$cohens_d$estimate[[1]],
                          results_exp_5_h2$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2$cohens_d$conf.int[["inf"]],
                        results_exp_2_h2$cohens_d$conf.int[["inf"]],
                        results_exp_3_h2$cohens_d$conf.int[["inf"]],
                        results_exp_4_h2$cohens_d$conf.int[["inf"]],
                        results_exp_5_h2$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h2$cohens_d$conf.int[["sup"]],
                        results_exp_2_h2$cohens_d$conf.int[["sup"]],
                        results_exp_3_h2$cohens_d$conf.int[["sup"]],
                        results_exp_4_h2$cohens_d$conf.int[["sup"]],
                        results_exp_5_h2$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2))

meta_results_h2 <- meta_analysis_workflow(data              = results_for_meta_analysis_h2,
                                          effect_size_label = "Cohen's d",
                                          exp_estimates     = FALSE,
                                          reference_line    = 0)

```

- Results demonstrated a significant effect of large size: `r meta_results_h2$meta_analysis_results_text`
- Results were found to contain a high degree of heterogeneity: `r meta_results_h2$heterogeneity_test_results_text`

#### Outlier tests

```{r fig.height=8, fig.width=4}

influence_meta_results_h2 <- influence(meta_results_h2$fitted_model)

print(influence_meta_results_h2, digits = 2) 

```

Experiment 2 was assessed as being an outlier. 

####  Sensitivity analysis

A sensitivity analysis excluded Experiment 2 and re meta analysed. 

```{r}

results_for_meta_analysis_h2_sensitivity <- results_for_meta_analysis_h2 %>%
  filter(Experiment != "Experiment 2")

# save for vector plotting later
write_csv(results_for_meta_analysis_h2_sensitivity, "../plots/results_for_meta_analysis_h2_sensitivity.csv")

meta_results_h2_sensitivity <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_sensitivity,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0)

```

- After excluding one experiment as an outlier, the meta analysed effect size was found to be of very large size (Sawilowsky, 2009): `r meta_results_h2_sensitivity$meta_analysis_results_text`, and heterogeneity was found to very negligable, `r meta_results_h2_sensitivity$heterogeneity_test_results_text`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

results_for_meta_analysis_h3 <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             logOR = c(results_exp_1_h3$logOR[results_exp_1_h3$var == "Struan"], 
                       results_exp_2_h3$logOR[results_exp_2_h3$var == "Struan"],
                       results_exp_3_h3$logOR[results_exp_3_h3$var == "Struan"],
                       results_exp_4_h3$logOR[results_exp_4_h3$var == "Struan"],
                       results_exp_5_h3$logOR[results_exp_5_h3$var == "Struan"]),
             logOR_se = c(results_exp_1_h3$logOR_se[results_exp_1_h3$var == "Struan"],
                          results_exp_2_h3$logOR_se[results_exp_2_h3$var == "Struan"],
                          results_exp_3_h3$logOR_se[results_exp_3_h3$var == "Struan"],
                          results_exp_4_h3$logOR_se[results_exp_4_h3$var == "Struan"],
                          results_exp_5_h3$logOR_se[results_exp_5_h3$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se)

meta_results_h3 <- meta_analysis_workflow(data = results_for_meta_analysis_h3,
                                          effect_size_label = "Odds Ratio",
                                          exp_estimates     = TRUE,
                                          reference_line    = 0)

```

- Results demonstrated a significant effect of medium size (Chen, Cohen, & Chen, 2010): `r meta_results_h3$meta_analysis_results_text`
- Results were found to contain a high degree of heterogeneity: `r meta_results_h3$heterogeneity_test_results_text`

#### Outlier tests

```{r fig.height=8, fig.width=4}

influence_meta_results_h3 <- influence(meta_results_h3$fitted_model)

print(influence_meta_results_h3, digits = 2) 

```

Experiment 2 was assessed as being an outlier. 

####  Sensitivity analysis

A sensitivity analysis excluded Experiment 2 and re meta analysed. 

```{r}

results_for_meta_analysis_h3_sensitivity <- results_for_meta_analysis_h3 %>%
  filter(Experiment != "Experiment 2")

# save for vector plotting later
write_csv(results_for_meta_analysis_h3_sensitivity, "../plots/results_for_meta_analysis_h3_sensitivity.csv")

meta_results_h3_sensitivity <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h3_sensitivity,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0)

```

- After excluding one experiment as an outlier, the meta analysed effect size was found to be of large size: `r meta_results_h3_sensitivity$meta_analysis_results_text`, and heterogeneity was found to be negligable, `r meta_results_h3_sensitivity$heterogeneity_test_results_text`.

## Robustness tests via meta analyses

### H1: IAT

Refit meta analyses after excluding subsets of participants based on the exploratory awareness variables. 

Note that these robustness tests also take the influence tests into account by excluding Experiment 2. 

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
results_exp_1_h1_contingency_memory <- tidied_data_exp_1 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_1_h1_demand_compliance <- tidied_data_exp_1 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_1_h1_hypothesis_aware <- tidied_data_exp_1 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_1_h1_influence_aware <- tidied_data_exp_1 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_2_h1_contingency_memory <- tidied_data_exp_2 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_2_h1_demand_compliance <- tidied_data_exp_2 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_2_h1_hypothesis_aware <- tidied_data_exp_2 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_2_h1_influence_aware <- tidied_data_exp_2 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_3_h1_contingency_memory <- tidied_data_exp_3 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_3_h1_demand_compliance <- tidied_data_exp_3 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_3_h1_hypothesis_aware <- tidied_data_exp_3 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_3_h1_influence_aware <- tidied_data_exp_3 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_4_h1_contingency_memory <- tidied_data_exp_4 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_4_h1_demand_compliance <- tidied_data_exp_4 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_4_h1_hypothesis_aware <- tidied_data_exp_4 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_4_h1_influence_aware <- tidied_data_exp_4 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_5_h1_contingency_memory <- tidied_data_exp_5 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_5_h1_demand_compliance <- tidied_data_exp_5 %>%
  filter(demand_IAT == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_5_h1_hypothesis_aware <- tidied_data_exp_5 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_5_h1_influence_aware <- tidied_data_exp_5 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = IAT_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


# contingency_memory
results_for_meta_analysis_h1_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h1_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_2_h1_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_3_h1_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_4_h1_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_5_h1_contingency_memory$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_2_h1_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_3_h1_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_4_h1_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_5_h1_contingency_memory$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h1_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_2_h1_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_3_h1_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_4_h1_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_5_h1_contingency_memory$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# demand_compliance
results_for_meta_analysis_h1_demand_compliance <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_2_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_3_h1_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_4_h1_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_5_h1_demand_compliance$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_2_h1_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_3_h1_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_4_h1_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_5_h1_demand_compliance$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h1_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_2_h1_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_3_h1_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_4_h1_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_5_h1_demand_compliance$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# hypothesis_aware
results_for_meta_analysis_h1_hypothesis_aware <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h1_hypothesis_aware$cohens_d$estimate[[1]], 
                          results_exp_2_h1_hypothesis_aware$cohens_d$estimate[[1]], 
                          results_exp_3_h1_hypothesis_aware$cohens_d$estimate[[1]], 
                          results_exp_4_h1_hypothesis_aware$cohens_d$estimate[[1]],
                          results_exp_5_h1_hypothesis_aware$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_2_h1_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_3_h1_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_4_h1_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_5_h1_hypothesis_aware$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h1_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_2_h1_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_3_h1_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_4_h1_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_5_h1_hypothesis_aware$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# influence_aware
results_for_meta_analysis_h1_influence_aware <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h1_influence_aware$cohens_d$estimate[[1]], 
                          results_exp_2_h1_influence_aware$cohens_d$estimate[[1]], 
                          results_exp_3_h1_influence_aware$cohens_d$estimate[[1]], 
                          results_exp_4_h1_influence_aware$cohens_d$estimate[[1]],
                          results_exp_5_h1_influence_aware$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h1_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_2_h1_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_3_h1_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_4_h1_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_5_h1_influence_aware$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h1_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_2_h1_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_3_h1_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_4_h1_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_5_h1_influence_aware$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# fit metas
meta_results_h1_contingency_memory <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_contingency_memory,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h1_demand_compliance <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_demand_compliance,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h1_hypothesis_aware <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_hypothesis_aware,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h1_influence_aware <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h1_influence_aware,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

# robustness strings
robustness_contingency_memory <-
  ifelse(robust_test(meta_results_h1_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_demand_compliance  <-
  ifelse(robust_test(meta_results_h1_demand_compliance$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_hypothesis_aware   <-
  ifelse(robust_test(meta_results_h1_hypothesis_aware$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_influence_aware    <-
  ifelse(robust_test(meta_results_h1_influence_aware$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

```

- Across studies, results `r robustness_contingency_memory` robust to including only participants who were contingency aware, p in subsample `r meta_results_h1_contingency_memory$meta_analysis_results$estimate[meta_results_h1_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_demand_compliance` robust to including only participants who were not demand compliant, p in subsample `r meta_results_h1_demand_compliance$meta_analysis_results$estimate[meta_results_h1_demand_compliance$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_hypothesis_aware` robust to including only participants who were not hypothesis aware, p in subsample `r meta_results_h1_hypothesis_aware$meta_analysis_results$estimate[meta_results_h1_hypothesis_aware$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_influence_aware` robust to including only participants who were not influence aware, p in subsample `r meta_results_h1_influence_aware$meta_analysis_results$estimate[meta_results_h1_influence_aware$meta_analysis_results$metric == "p"]`.

### H2: Self-report ratings

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
results_exp_1_h2_contingency_memory <- tidied_data_exp_1 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_1_h2_demand_compliance <- tidied_data_exp_1 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_1_h2_hypothesis_aware <- tidied_data_exp_1 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_1_h2_influence_aware <- tidied_data_exp_1 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_2_h2_contingency_memory <- tidied_data_exp_2 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_2_h2_demand_compliance <- tidied_data_exp_2 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_2_h2_hypothesis_aware <- tidied_data_exp_2 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_2_h2_influence_aware <- tidied_data_exp_2 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_3_h2_contingency_memory <- tidied_data_exp_3 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_3_h2_demand_compliance <- tidied_data_exp_3 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_3_h2_hypothesis_aware <- tidied_data_exp_3 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_3_h2_influence_aware <- tidied_data_exp_3 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_4_h2_contingency_memory <- tidied_data_exp_4 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_4_h2_demand_compliance <- tidied_data_exp_4 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_4_h2_hypothesis_aware <- tidied_data_exp_4 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_4_h2_influence_aware <- tidied_data_exp_4 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


results_exp_5_h2_contingency_memory <- tidied_data_exp_5 %>%
  filter(contingency_memory == TRUE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_5_h2_demand_compliance <- tidied_data_exp_5 %>%
  filter(demand_self_reports == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_5_h2_hypothesis_aware <- tidied_data_exp_5 %>%
  filter(hypothesis_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)

results_exp_5_h2_influence_aware <- tidied_data_exp_5 %>%
  filter(influence_awareness == FALSE) %>%
  mutate(DV = EC_Effect_CS1_CS2_Difference_Score,
         IV = Color_Matching) %>%
  t_test_analyses(.)


# contingency_memory
results_for_meta_analysis_h2_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h2_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_2_h2_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_3_h2_contingency_memory$cohens_d$estimate[[1]], 
                          results_exp_4_h2_contingency_memory$cohens_d$estimate[[1]],
                          results_exp_5_h2_contingency_memory$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_2_h2_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_3_h2_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_4_h2_contingency_memory$cohens_d$conf.int[["inf"]],
                        results_exp_5_h2_contingency_memory$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h2_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_2_h2_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_3_h2_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_4_h2_contingency_memory$cohens_d$conf.int[["sup"]],
                        results_exp_5_h2_contingency_memory$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# demand_compliance
results_for_meta_analysis_h2_demand_compliance <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_2_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_3_h2_demand_compliance$cohens_d$estimate[[1]], 
                          results_exp_4_h2_demand_compliance$cohens_d$estimate[[1]],
                          results_exp_5_h2_demand_compliance$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_2_h2_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_3_h2_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_4_h2_demand_compliance$cohens_d$conf.int[["inf"]],
                        results_exp_5_h2_demand_compliance$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h2_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_2_h2_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_3_h2_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_4_h2_demand_compliance$cohens_d$conf.int[["sup"]],
                        results_exp_5_h2_demand_compliance$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# hypothesis_aware
results_for_meta_analysis_h2_hypothesis_aware <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h2_hypothesis_aware$cohens_d$estimate[[1]], 
                          results_exp_2_h2_hypothesis_aware$cohens_d$estimate[[1]], 
                          results_exp_3_h2_hypothesis_aware$cohens_d$estimate[[1]], 
                          results_exp_4_h2_hypothesis_aware$cohens_d$estimate[[1]],
                          results_exp_5_h2_hypothesis_aware$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_2_h2_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_3_h2_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_4_h2_hypothesis_aware$cohens_d$conf.int[["inf"]],
                        results_exp_5_h2_hypothesis_aware$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h2_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_2_h2_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_3_h2_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_4_h2_hypothesis_aware$cohens_d$conf.int[["sup"]],
                        results_exp_5_h2_hypothesis_aware$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# influence_aware
results_for_meta_analysis_h2_influence_aware <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             cohens_d = c(results_exp_1_h2_influence_aware$cohens_d$estimate[[1]], 
                          results_exp_2_h2_influence_aware$cohens_d$estimate[[1]], 
                          results_exp_3_h2_influence_aware$cohens_d$estimate[[1]], 
                          results_exp_4_h2_influence_aware$cohens_d$estimate[[1]],
                          results_exp_5_h2_influence_aware$cohens_d$estimate[[1]]),
             ci_lwr = c(results_exp_1_h2_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_2_h2_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_3_h2_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_4_h2_influence_aware$cohens_d$conf.int[["inf"]],
                        results_exp_5_h2_influence_aware$cohens_d$conf.int[["inf"]]),
             ci_upr = c(results_exp_1_h2_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_2_h2_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_3_h2_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_4_h2_influence_aware$cohens_d$conf.int[["sup"]],
                        results_exp_5_h2_influence_aware$cohens_d$conf.int[["sup"]])) %>%
  mutate(yi = cohens_d, 
         sei = (ci_upr - ci_lwr)/(1.96*2)) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# fit metas
meta_results_h2_contingency_memory <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_contingency_memory,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h2_demand_compliance <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_demand_compliance,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h2_hypothesis_aware <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_hypothesis_aware,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h2_influence_aware <- 
  meta_analysis_workflow(data              = results_for_meta_analysis_h2_influence_aware,
                         effect_size_label = "Cohen's d",
                         exp_estimates     = FALSE,
                         reference_line    = 0,
                         plot = FALSE)

# robustness strings
robustness_contingency_memory <-
  ifelse(robust_test(meta_results_h2_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_demand_compliance  <-
  ifelse(robust_test(meta_results_h2_demand_compliance$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_hypothesis_aware   <-
  ifelse(robust_test(meta_results_h2_hypothesis_aware$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_influence_aware    <-
  ifelse(robust_test(meta_results_h2_influence_aware$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

```

- Across studies, results `r robustness_contingency_memory` robust to including only participants who were contingency aware, p in subsample `r meta_results_h2_contingency_memory$meta_analysis_results$estimate[meta_results_h2_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_demand_compliance` robust to including only participants who were not demand compliant, p in subsample `r meta_results_h2_demand_compliance$meta_analysis_results$estimate[meta_results_h2_demand_compliance$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_hypothesis_aware` robust to including only participants who were not hypothesis aware, p in subsample `r meta_results_h2_hypothesis_aware$meta_analysis_results$estimate[meta_results_h2_hypothesis_aware$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_influence_aware` robust to including only participants who were not influence aware, p in subsample `r meta_results_h2_influence_aware$meta_analysis_results$estimate[meta_results_h2_influence_aware$meta_analysis_results$metric == "p"]`.

### H3: Behavioural intentions

```{r echo=TRUE, results='hide'}

# re run tests with desired subsets of participants
results_exp_1_h3_contingency_memory <- tidied_data_exp_1 %>%
  filter(contingency_memory == TRUE) %>%
  multinominal_analysis(.)

results_exp_1_h3_hypothesis_aware <- tidied_data_exp_1 %>%
  filter(hypothesis_awareness == FALSE) %>%
  multinominal_analysis(.)

results_exp_1_h3_influence_aware <- tidied_data_exp_1 %>%
  filter(influence_awareness == FALSE) %>%
  multinominal_analysis(.)


results_exp_2_h3_contingency_memory <- tidied_data_exp_2 %>%
  filter(contingency_memory == TRUE) %>%
  multinominal_analysis(.)

results_exp_2_h3_hypothesis_aware <- tidied_data_exp_2 %>%
  filter(hypothesis_awareness == FALSE) %>%
  multinominal_analysis(.)

results_exp_2_h3_influence_aware <- tidied_data_exp_2 %>%
  filter(influence_awareness == FALSE) %>%
  multinominal_analysis(.)


results_exp_3_h3_contingency_memory <- tidied_data_exp_3 %>%
  filter(contingency_memory == TRUE) %>%
  multinominal_analysis(.)

results_exp_3_h3_hypothesis_aware <- tidied_data_exp_3 %>%
  filter(hypothesis_awareness == FALSE) %>%
  multinominal_analysis(.)

results_exp_3_h3_influence_aware <- tidied_data_exp_3 %>%
  filter(influence_awareness == FALSE) %>%
  multinominal_analysis(.)


results_exp_4_h3_contingency_memory <- tidied_data_exp_4 %>%
  filter(contingency_memory == TRUE) %>%
  multinominal_analysis(.)

results_exp_4_h3_hypothesis_aware <- tidied_data_exp_4 %>%
  filter(hypothesis_awareness == FALSE) %>%
  multinominal_analysis(.)

results_exp_4_h3_influence_aware <- tidied_data_exp_4 %>%
  filter(influence_awareness == FALSE) %>%
  multinominal_analysis(.)


results_exp_5_h3_contingency_memory <- tidied_data_exp_5 %>%
  filter(contingency_memory == TRUE) %>%
  multinominal_analysis(.)

results_exp_5_h3_hypothesis_aware <- tidied_data_exp_5 %>%
  filter(hypothesis_awareness == FALSE) %>%
  multinominal_analysis(.)

results_exp_5_h3_influence_aware <- tidied_data_exp_5 %>%
  filter(influence_awareness == FALSE) %>%
  multinominal_analysis(.)


results_for_meta_analysis_h3_contingency_memory <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             logOR = c(results_exp_1_h3_contingency_memory$logOR[results_exp_1_h3_contingency_memory$var == "Struan"], 
                       results_exp_2_h3_contingency_memory$logOR[results_exp_2_h3_contingency_memory$var == "Struan"],
                       results_exp_3_h3_contingency_memory$logOR[results_exp_3_h3_contingency_memory$var == "Struan"],
                       results_exp_4_h3_contingency_memory$logOR[results_exp_4_h3_contingency_memory$var == "Struan"],
                       results_exp_5_h3_contingency_memory$logOR[results_exp_5_h3_contingency_memory$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_contingency_memory$logOR_se[results_exp_1_h3_contingency_memory$var == "Struan"],
                          results_exp_2_h3_contingency_memory$logOR_se[results_exp_2_h3_contingency_memory$var == "Struan"],
                          results_exp_3_h3_contingency_memory$logOR_se[results_exp_3_h3_contingency_memory$var == "Struan"],
                          results_exp_4_h3_contingency_memory$logOR_se[results_exp_4_h3_contingency_memory$var == "Struan"],
                          results_exp_5_h3_contingency_memory$logOR_se[results_exp_5_h3_contingency_memory$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

results_for_meta_analysis_h3_hypothesis_aware <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             logOR = c(results_exp_1_h3_hypothesis_aware$logOR[results_exp_1_h3_hypothesis_aware$var == "Struan"], 
                       results_exp_2_h3_hypothesis_aware$logOR[results_exp_2_h3_hypothesis_aware$var == "Struan"],
                       results_exp_3_h3_hypothesis_aware$logOR[results_exp_3_h3_hypothesis_aware$var == "Struan"],
                       results_exp_4_h3_hypothesis_aware$logOR[results_exp_4_h3_hypothesis_aware$var == "Struan"],
                       results_exp_5_h3_hypothesis_aware$logOR[results_exp_5_h3_hypothesis_aware$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_hypothesis_aware$logOR_se[results_exp_1_h3_hypothesis_aware$var == "Struan"],
                          results_exp_2_h3_hypothesis_aware$logOR_se[results_exp_2_h3_hypothesis_aware$var == "Struan"],
                          results_exp_3_h3_hypothesis_aware$logOR_se[results_exp_3_h3_hypothesis_aware$var == "Struan"],
                          results_exp_4_h3_hypothesis_aware$logOR_se[results_exp_4_h3_hypothesis_aware$var == "Struan"],
                          results_exp_5_h3_hypothesis_aware$logOR_se[results_exp_5_h3_hypothesis_aware$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

results_for_meta_analysis_h3_influence_aware <- 
  data.frame(Experiment = c("Experiment 1", "Experiment 2", "Experiment 3", "Experiment 4", "Experiment 5"),
             logOR = c(results_exp_1_h3_influence_aware$logOR[results_exp_1_h3_influence_aware$var == "Struan"], 
                       results_exp_2_h3_influence_aware$logOR[results_exp_2_h3_influence_aware$var == "Struan"],
                       results_exp_3_h3_influence_aware$logOR[results_exp_3_h3_influence_aware$var == "Struan"],
                       results_exp_4_h3_influence_aware$logOR[results_exp_4_h3_influence_aware$var == "Struan"],
                       results_exp_5_h3_influence_aware$logOR[results_exp_5_h3_influence_aware$var == "Struan"]),
             logOR_se = c(results_exp_1_h3_influence_aware$logOR_se[results_exp_1_h3_influence_aware$var == "Struan"],
                          results_exp_2_h3_influence_aware$logOR_se[results_exp_2_h3_influence_aware$var == "Struan"],
                          results_exp_3_h3_influence_aware$logOR_se[results_exp_3_h3_influence_aware$var == "Struan"],
                          results_exp_4_h3_influence_aware$logOR_se[results_exp_4_h3_influence_aware$var == "Struan"],
                          results_exp_5_h3_influence_aware$logOR_se[results_exp_5_h3_influence_aware$var == "Struan"])) %>%
  mutate(yi  = logOR,
         sei = logOR_se) %>%
  # remove exp 2 on the basis of the influence test 
  filter(Experiment != "Experiment 2")

# meta fits
meta_results_h3_contingency_memory <- 
  meta_analysis_workflow(data = results_for_meta_analysis_h3_contingency_memory,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h3_hypothesis_aware <- 
  meta_analysis_workflow(data = results_for_meta_analysis_h3_hypothesis_aware,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0,
                         plot = FALSE)

meta_results_h3_influence_aware <- 
  meta_analysis_workflow(data = results_for_meta_analysis_h3_influence_aware,
                         effect_size_label = "Odds Ratio",
                         exp_estimates     = TRUE,
                         reference_line    = 0,
                         plot = FALSE)

# robustness strings
robustness_contingency_memory <-
  ifelse(robust_test(meta_results_h3_contingency_memory$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_hypothesis_aware   <-
  ifelse(robust_test(meta_results_h3_hypothesis_aware$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

robustness_influence_aware    <-
  ifelse(robust_test(meta_results_h3_influence_aware$meta_analysis_results, 
                     meta_results_h1$meta_analysis_results),
         "were", "were not")

```

- Across studies, results `r robustness_contingency_memory` robust to including only participants who were contingency aware, p in subsample `r meta_results_h3_contingency_memory$meta_analysis_results$estimate[meta_results_h3_contingency_memory$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_hypothesis_aware` robust to including only participants who were not hypothesis aware, p in subsample `r meta_results_h3_hypothesis_aware$meta_analysis_results$estimate[meta_results_h3_hypothesis_aware$meta_analysis_results$metric == "p"]`.
- Across studies, results `r robustness_influence_aware` robust to including only participants who were not influence aware, p in subsample `r meta_results_h3_influence_aware$meta_analysis_results$estimate[meta_results_h3_influence_aware$meta_analysis_results$metric == "p"]`.

# Plots

## Distribution of IAT and ratings in Experiment 2

Experiment 3 was informed by the unexpected results of experiment 2, which prompted us to examine the distribution of scores on the IAT and self reports which suggested bi- and tri-modality. This is depicted below.

```{r}

tidied_data_exp_2 %>%
  select(Participant, Color_Matching, IAT_Score, EC_Effect_CS1_CS2_Difference_Score) %>%
  rename(`IAT D score` = IAT_Score,
         `Ratings difference score` = EC_Effect_CS1_CS2_Difference_Score) %>%
  gather(dv_modality, dv_score, c(`IAT D score`, `Ratings difference score`)) %>%
  ggplot(aes(dv_score)) +
  geom_density(adjust = 0.5) +
  facet_wrap(~dv_modality+Color_Matching, scales = "free") +
  theme_classic() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        panel.border = element_blank()) +
  xlab("") +
  ylab("Probability density")

```

